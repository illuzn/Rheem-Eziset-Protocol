{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Unofficial Rheem Eziset Protocol Documentation","text":"<p>These pages seek to document the Rheem Eziset Protocol. </p> <p>The Rheem Eziset is a device used to control the hotwater temperatures of certain Rheem Hot Water Systems. This device appears to be a local variant only available in Australia for now.</p> <p>The device is made available to trades via trade wholesalers. Residential customers may purchase these devices from plumbing wholesalers by implying that they are a tradesman and quoting the following Rheem Product/ Part Code: <code>052310</code>. The trade price is around AU$300 but your results may vary.</p> <p>Please note that while Rheem officially calls this device the Rheem EZiSET Kit - wholesalers have listed this device under various other names. The author purchased this device under the <code>Rheem Smartec Communicator</code> name.</p> <p>Disclaimer: The author has no affiliation with Rheem Australia Pty Ltd or any other of its group companies. The information on this website has been obtained by packet sniffing and reverse engineering only and, accordingly, may not be accurate. No representation or warranty is given that the information contained on this website is official or correct. Use the information on this website at your own risk.</p> <p>Copyright Notice: Unless otherwise stated, images used on this website belong to Rheem Australia Pty Ltd. They are used on this website on the basis of fair use and to the limited extent required to document the protocol used by the Rheem Eziset system.</p> <p>Rheem and EZiSET are trademarks of Rheem Australia Pty Ltd. These trademarks are used on these pages under fair use and no affiliation or association with Rheem Australia Pty Ltd or any of its group companies is intended or to be inferred by the use of these marks.</p>"},{"location":"contribute/","title":"Contribute","text":"<p>All contributions are welcome. To contribute submit a pull request against the main branch of the repository.</p> <p>Thank you to the following people for their valuable contributions:</p> <ul> <li>jdymond on the Home Assistant Community Forums for further information about the powerline device.</li> </ul> <p>To contact the author with any other issues, submit an issue against the main branch of the repository.</p>"},{"location":"ha/","title":"Home Assistant","text":"<p>Currently, I am using the Node-Red addon to make this work with Home Assistant.</p> <p>This new code:</p> <ol> <li>Encapsulates all of the controls/ sensors in 1 device.</li> <li>(Hopefully) Refines the logic so it works more correctly.</li> <li>Removes most of the hard-coded values into <code>number</code> entities which are configurable from the HA front-end.</li> <li>Is much more responsive (the previous method required a change being made to a HA entity, which would be picked up by an event handler in Node-RED). After testing, temperature changes take 1-2 seconds as opposed to up to 5s that it would previously take.</li> </ol>"},{"location":"ha/#changelog","title":"Changelog","text":""},{"location":"ha/#v-11","title":"v 1.1","text":"<ul> <li>Correct logic and simplify Timeout function using better nodes</li> <li>Correct logic of google assistant switch</li> <li>All variables should now be configurable via <code>number</code> entities</li> </ul>"},{"location":"ha/#v-10","title":"v 1.0:","text":"<p>Initial Release</p>"},{"location":"ha/#to-do","title":"To-Do","text":"<ol> <li>~~Handling when flow is first deployed (the required flow variables may not be set).~~</li> <li>Bugchecking</li> <li>Bath fill mode (low priority I do not use this function)</li> </ol>"},{"location":"ha/#working-theory","title":"Working Theory","text":"<p>The below Node-Red flow creates a \"Rheem Hot Water System\" device with 7 (9 with the optional Google Home helper) entities:</p> <ul> <li><code>number.hot_water_temperature</code>: This is used to set the desired hot water temperature in degrees C. It accepts the same values as the app - namely between 37C and 50C.</li> <li><code>sensor.hot_water_current_temperature</code>: This is the currently set hot water temperature in degrees. This may not always be the same as the requested temperature in <code>number.hot_water_temperature</code> because, for example, the worker thread is still requesting the new temperature or if <code>sensor.hot_water_flow</code> is non-zero for safety reasons the temperature cannot be set.</li> <li><code>sensor.hot_water_flow</code>: The current flow rate through the hot water system in L/minute.</li> <li><code>switch.automation_hot_water_timeout</code>: This enables/ disables the automatic timeout of the set hot water temperature. This is a safety feature because even though 50C meets Australian Standards for hot water<sup>1</sup>; 50C is far too hot for me as an adult and is still capable of scalding especially vulnerable persons such as the elderly and children. Enabling this will reset the temperature to the set default temperature (see below) after the set timeout (see below).</li> <li><code>number.hot_water_default_temperature</code>: This sets temperature that the hot water system will return to after the relevant timeout.</li> <li><code>number.hot_water_timeout</code>: This sets how long to wait until the temperature is reset to default.</li> <li> <p><code>binary_sensor.hot_water_system_fault</code>: This will report a fault if the update worker cannot retrieve the status from the Rheem System. This is likely due to the connection dropping out and based upon my experience can happen sporadically.</p> </li> <li> <p><code>switch.hot_water</code> (optional): This is an on/off switch which switches between <code>number.hot_water_default_temperature</code> and <code>number.hot_water_google_assistant_hot_temperature</code>. Not strictly necessary but google assistant and siri cannot handle <code>number</code> so this is a workaround which allows you to switch between your two most frequent settings (I use this for the laundry/ dishwasher which needs hotter temperatures).</p> </li> <li><code>number.hot_water_google_assistant_hot_temperature</code> (optional): This is used to set the \"hot\" temperature used by assistants when the switch is turned on. Additionally the logic will automatically turn on the switch if <code>number.hot_water_temperature</code> is equal to or above this value (allowing you to turn the hot water \"off\").</li> </ul>"},{"location":"ha/#code-v11","title":"Code v1.1","text":""},{"location":"ha/#node-red-flow","title":"Node-Red Flow","text":"<p>Import the following flow into Node Red - do not forget to configure the IP addresses and the HA API integrations as relevant for you.</p> Node-Red Flow<pre><code>[{\"id\":\"5b42f717a84ae8e1\",\"type\":\"http request\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Get Current Info\",\"method\":\"GET\",\"ret\":\"obj\",\"paytoqs\":\"ignore\",\"url\":\"http://XXX.XXX.XXX.XXX/getInfo.cgi\",\"tls\":\"\",\"persist\":false,\"proxy\":\"\",\"insecureHTTPParser\":false,\"authType\":\"\",\"senderr\":false,\"headers\":[],\"x\":700,\"y\":100,\"wires\":[[\"2396d678c51f07e1\"]]},{\"id\":\"b5f5f860f82d95f1\",\"type\":\"inject\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Status Update Worker\",\"props\":[{\"p\":\"payload\"}],\"repeat\":\"1\",\"crontab\":\"\",\"once\":true,\"onceDelay\":\"10\",\"topic\":\"\",\"payload\":\"\",\"payloadType\":\"date\",\"x\":210,\"y\":100,\"wires\":[[\"e9d184371b445d91\"]]},{\"id\":\"ab64e497209d9b70\",\"type\":\"change\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Store it in flow.temperature\",\"rules\":[{\"t\":\"set\",\"p\":\"temperature\",\"pt\":\"flow\",\"to\":\"payload\",\"tot\":\"msg\"}],\"action\":\"\",\"property\":\"\",\"from\":\"\",\"to\":\"\",\"reg\":false,\"x\":1040,\"y\":340,\"wires\":[[\"c3f6338723a63d68\"]]},{\"id\":\"eced634799386a54\",\"type\":\"http request\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Take Control of Rheem System\",\"method\":\"GET\",\"ret\":\"obj\",\"paytoqs\":\"ignore\",\"url\":\"http://XXX.XXX.XXX.XXX/ctrl.cgi?sid=0&amp;heatingCtrl=1\",\"tls\":\"\",\"persist\":false,\"proxy\":\"\",\"authType\":\"\",\"senderr\":false,\"x\":230,\"y\":480,\"wires\":[[\"9746d74387ecf508\"]]},{\"id\":\"9746d74387ecf508\",\"type\":\"switch\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Check if Error\",\"property\":\"payload.sid\",\"propertyType\":\"msg\",\"rules\":[{\"t\":\"eq\",\"v\":\"0\",\"vt\":\"str\"},{\"t\":\"else\"}],\"checkall\":\"true\",\"repair\":false,\"outputs\":2,\"x\":480,\"y\":480,\"wires\":[[],[\"b14b73714804ea04\"]]},{\"id\":\"b14b73714804ea04\",\"type\":\"change\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Store Session ID in flow.sid\",\"rules\":[{\"t\":\"set\",\"p\":\"sid\",\"pt\":\"flow\",\"to\":\"payload.sid\",\"tot\":\"msg\"}],\"action\":\"\",\"property\":\"\",\"from\":\"\",\"to\":\"\",\"reg\":false,\"x\":720,\"y\":480,\"wires\":[[\"0693e8ca6891c5db\"]]},{\"id\":\"0693e8ca6891c5db\",\"type\":\"function\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Setup the url\",\"func\":\"var t = flow.get(\\\"temperature\\\");\\nvar s = flow.get(\\\"sid\\\");\\n\\nmsg.url = \\\"http://XXX.XXX.XXX.XXX/set.cgi?sid=\\\" + s + \\\"&amp;setTemp=\\\" + t\\n\\nreturn msg;\",\"outputs\":1,\"noerr\":0,\"initialize\":\"\",\"finalize\":\"\",\"libs\":[],\"x\":930,\"y\":480,\"wires\":[[\"537a2e81dc41d614\"]]},{\"id\":\"537a2e81dc41d614\",\"type\":\"http request\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Request New Temp\",\"method\":\"GET\",\"ret\":\"obj\",\"paytoqs\":\"ignore\",\"url\":\"\",\"tls\":\"\",\"persist\":false,\"proxy\":\"\",\"authType\":\"\",\"senderr\":false,\"x\":1110,\"y\":480,\"wires\":[[\"74d1ee1c63cfa749\"]]},{\"id\":\"74d1ee1c63cfa749\",\"type\":\"switch\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Check for Error State\",\"property\":\"payload.reqtemp\",\"propertyType\":\"msg\",\"rules\":[{\"t\":\"eq\",\"v\":\"temperature\",\"vt\":\"flow\"},{\"t\":\"else\"}],\"checkall\":\"true\",\"repair\":false,\"outputs\":2,\"x\":1320,\"y\":480,\"wires\":[[\"51a197d8852cecb5\"],[\"d4d276c7a7a33b42\",\"62334558a9bb2eb5\",\"51a197d8852cecb5\"]]},{\"id\":\"62334558a9bb2eb5\",\"type\":\"debug\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Print Payload for Debugging\",\"active\":true,\"tosidebar\":true,\"console\":true,\"tostatus\":false,\"complete\":\"payload\",\"targetType\":\"msg\",\"statusVal\":\"\",\"statusType\":\"auto\",\"x\":1630,\"y\":560,\"wires\":[]},{\"id\":\"d4d276c7a7a33b42\",\"type\":\"debug\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Print encoded url for Debugging\",\"active\":true,\"tosidebar\":true,\"console\":true,\"tostatus\":false,\"complete\":\"url\",\"targetType\":\"msg\",\"statusVal\":\"\",\"statusType\":\"auto\",\"x\":1640,\"y\":600,\"wires\":[]},{\"id\":\"51a197d8852cecb5\",\"type\":\"delay\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Wait 1s\",\"pauseType\":\"delay\",\"timeout\":\"1\",\"timeoutUnits\":\"seconds\",\"rate\":\"1\",\"nbRateUnits\":\"1\",\"rateUnits\":\"second\",\"randomFirst\":\"1\",\"randomLast\":\"5\",\"randomUnits\":\"seconds\",\"drop\":false,\"allowrate\":false,\"outputs\":1,\"x\":1540,\"y\":480,\"wires\":[[\"ad81a1605da79aad\"]]},{\"id\":\"ad81a1605da79aad\",\"type\":\"function\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Setup the url\",\"func\":\"var s = flow.get(\\\"sid\\\");\\n\\nmsg.url = \\\"http://XXX.XXX.XXX.XXX/ctrl.cgi?sid=\\\" + s + \\\"&amp;heatingCtrl=0\\\"\\n\\nreturn msg;\",\"outputs\":1,\"noerr\":0,\"initialize\":\"\",\"finalize\":\"\",\"libs\":[],\"x\":1710,\"y\":480,\"wires\":[[\"a76078cb19481e28\"]]},{\"id\":\"a76078cb19481e28\",\"type\":\"http request\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Relinquish Control\",\"method\":\"GET\",\"ret\":\"obj\",\"paytoqs\":\"ignore\",\"url\":\"\",\"tls\":\"\",\"persist\":false,\"proxy\":\"\",\"authType\":\"\",\"senderr\":false,\"x\":1890,\"y\":480,\"wires\":[[\"9c423f42122a3e93\",\"ac8632db6b12bc0d\"]]},{\"id\":\"9c423f42122a3e93\",\"type\":\"switch\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Check for Error State\",\"property\":\"payload.sTimeout\",\"propertyType\":\"msg\",\"rules\":[{\"t\":\"eq\",\"v\":\"0\",\"vt\":\"str\"},{\"t\":\"else\"}],\"checkall\":\"true\",\"repair\":false,\"outputs\":2,\"x\":2100,\"y\":480,\"wires\":[[],[\"5d703d0aac38620e\",\"5d333b0168fd49af\"]]},{\"id\":\"5d703d0aac38620e\",\"type\":\"debug\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Print Payload for Debugging\",\"active\":true,\"tosidebar\":true,\"console\":true,\"tostatus\":false,\"complete\":\"payload\",\"targetType\":\"msg\",\"statusVal\":\"\",\"statusType\":\"auto\",\"x\":2070,\"y\":560,\"wires\":[]},{\"id\":\"5d333b0168fd49af\",\"type\":\"debug\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Print encoded url for Debugging\",\"active\":true,\"tosidebar\":true,\"console\":true,\"tostatus\":false,\"complete\":\"url\",\"targetType\":\"msg\",\"statusVal\":\"\",\"statusType\":\"auto\",\"x\":2080,\"y\":600,\"wires\":[]},{\"id\":\"8078e213ff20ebe9\",\"type\":\"api-call-service\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Reset to Default Temperature\",\"server\":\"f1028730287dd073\",\"version\":5,\"debugenabled\":false,\"domain\":\"number\",\"service\":\"set_value\",\"areaId\":[],\"deviceId\":[],\"entityId\":[\"number.hot_water_temperature\"],\"data\":\"{ \\\"value\\\": default_temperature }\",\"dataType\":\"jsonata\",\"mergeContext\":\"\",\"mustacheAltTags\":false,\"outputProperties\":[],\"queue\":\"none\",\"x\":700,\"y\":880,\"wires\":[[]]},{\"id\":\"ac8632db6b12bc0d\",\"type\":\"change\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Enable Set Temp\",\"rules\":[{\"t\":\"set\",\"p\":\"set_temp_enable\",\"pt\":\"flow\",\"to\":\"true\",\"tot\":\"bool\"}],\"action\":\"\",\"property\":\"\",\"from\":\"\",\"to\":\"\",\"reg\":false,\"x\":2090,\"y\":440,\"wires\":[[]]},{\"id\":\"c896f86b6918ce48\",\"type\":\"inject\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Reset\",\"props\":[{\"p\":\"payload\"},{\"p\":\"topic\",\"vt\":\"str\"}],\"repeat\":\"\",\"crontab\":\"\",\"once\":false,\"onceDelay\":0.1,\"topic\":\"\",\"payload\":\"\",\"payloadType\":\"date\",\"x\":1910,\"y\":420,\"wires\":[[\"ac8632db6b12bc0d\"]]},{\"id\":\"c3f6338723a63d68\",\"type\":\"switch\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Only 1 at a time\",\"property\":\"set_temp_enable\",\"propertyType\":\"flow\",\"rules\":[{\"t\":\"false\"},{\"t\":\"else\"}],\"checkall\":\"true\",\"repair\":false,\"outputs\":2,\"x\":1260,\"y\":340,\"wires\":[[],[\"042514a7082e23c7\"]],\"info\":\"Setting this bit only allows one change to occur at a time. This can be an issue if the temperature is adjusted multiple times very quickly.\"},{\"id\":\"9e45702398f76732\",\"type\":\"change\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Disable Set Temp\",\"rules\":[{\"t\":\"set\",\"p\":\"set_temp_enable\",\"pt\":\"flow\",\"to\":\"false\",\"tot\":\"bool\"}],\"action\":\"\",\"property\":\"\",\"from\":\"\",\"to\":\"\",\"reg\":false,\"x\":2090,\"y\":340,\"wires\":[[\"eced634799386a54\"]]},{\"id\":\"3559c1ec83840f53\",\"type\":\"inject\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Reset Enable Flag Worker\",\"props\":[{\"p\":\"payload\"}],\"repeat\":\"5\",\"crontab\":\"\",\"once\":true,\"onceDelay\":\"10\",\"topic\":\"\",\"payload\":\"\",\"payloadType\":\"date\",\"x\":220,\"y\":980,\"wires\":[[\"b99426195443e181\",\"a77eab72b919fa50\"]],\"info\":\"The device is very finicky and even with my hot water heater around 3 metres from the wifi module it drops out every now and then.\\r\\nThis resets the enable flags once per minute in case there is a connectivity issue to deal with this potential issue.\"},{\"id\":\"b99426195443e181\",\"type\":\"switch\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Status Enable Flag\",\"property\":\"get_status_enable\",\"propertyType\":\"flow\",\"rules\":[{\"t\":\"false\"},{\"t\":\"else\"}],\"checkall\":\"true\",\"repair\":false,\"outputs\":2,\"x\":490,\"y\":960,\"wires\":[[\"177d3d08ba3c7dac\"],[]]},{\"id\":\"a77eab72b919fa50\",\"type\":\"switch\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Temp Enable Flag\",\"property\":\"set_temp_enable\",\"propertyType\":\"flow\",\"rules\":[{\"t\":\"false\"},{\"t\":\"else\"}],\"checkall\":\"true\",\"repair\":false,\"outputs\":2,\"x\":490,\"y\":1020,\"wires\":[[\"e453f5396d7ade80\"],[]]},{\"id\":\"177d3d08ba3c7dac\",\"type\":\"delay\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Rate Limit to 1 per Minute\",\"pauseType\":\"rate\",\"timeout\":\"5\",\"timeoutUnits\":\"seconds\",\"rate\":\"1\",\"nbRateUnits\":\"1\",\"rateUnits\":\"minute\",\"randomFirst\":\"1\",\"randomLast\":\"5\",\"randomUnits\":\"seconds\",\"drop\":true,\"allowrate\":false,\"outputs\":1,\"x\":730,\"y\":960,\"wires\":[[\"923ef1f2ef005460\"]]},{\"id\":\"e453f5396d7ade80\",\"type\":\"delay\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Rate Limit to 1 per Minute\",\"pauseType\":\"rate\",\"timeout\":\"5\",\"timeoutUnits\":\"seconds\",\"rate\":\"1\",\"nbRateUnits\":\"1\",\"rateUnits\":\"minute\",\"randomFirst\":\"1\",\"randomLast\":\"5\",\"randomUnits\":\"seconds\",\"drop\":true,\"allowrate\":false,\"outputs\":1,\"x\":730,\"y\":1020,\"wires\":[[\"2edd37d95f8da095\"]]},{\"id\":\"923ef1f2ef005460\",\"type\":\"delay\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Wait 1 minute\",\"pauseType\":\"delay\",\"timeout\":\"1\",\"timeoutUnits\":\"minutes\",\"rate\":\"1\",\"nbRateUnits\":\"1\",\"rateUnits\":\"second\",\"randomFirst\":\"1\",\"randomLast\":\"5\",\"randomUnits\":\"seconds\",\"drop\":false,\"allowrate\":false,\"outputs\":1,\"x\":1000,\"y\":960,\"wires\":[[\"2d2af9e970c7c24a\"]]},{\"id\":\"2edd37d95f8da095\",\"type\":\"delay\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Wait 1 minute\",\"pauseType\":\"delay\",\"timeout\":\"1\",\"timeoutUnits\":\"minutes\",\"rate\":\"1\",\"nbRateUnits\":\"1\",\"rateUnits\":\"second\",\"randomFirst\":\"1\",\"randomLast\":\"5\",\"randomUnits\":\"seconds\",\"drop\":false,\"allowrate\":false,\"outputs\":1,\"x\":1000,\"y\":1020,\"wires\":[[\"eae7323633b22869\"]]},{\"id\":\"2d2af9e970c7c24a\",\"type\":\"change\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Enable Status check\",\"rules\":[{\"t\":\"set\",\"p\":\"get_status_enable\",\"pt\":\"flow\",\"to\":\"true\",\"tot\":\"bool\"}],\"action\":\"\",\"property\":\"\",\"from\":\"\",\"to\":\"\",\"reg\":false,\"x\":1220,\"y\":960,\"wires\":[[\"72a9ccfb8a182444\"]]},{\"id\":\"eae7323633b22869\",\"type\":\"change\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Enable Set Temp\",\"rules\":[{\"t\":\"set\",\"p\":\"set_temp_enable\",\"pt\":\"flow\",\"to\":\"true\",\"tot\":\"bool\"}],\"action\":\"\",\"property\":\"\",\"from\":\"\",\"to\":\"\",\"reg\":false,\"x\":1210,\"y\":1020,\"wires\":[[\"d0f52e80b4f985e0\"]]},{\"id\":\"72a9ccfb8a182444\",\"type\":\"change\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Reset\",\"rules\":[{\"t\":\"set\",\"p\":\"reset\",\"pt\":\"msg\",\"to\":\"true\",\"tot\":\"bool\"}],\"action\":\"\",\"property\":\"\",\"from\":\"\",\"to\":\"\",\"reg\":false,\"x\":1430,\"y\":960,\"wires\":[[\"923ef1f2ef005460\",\"177d3d08ba3c7dac\"]]},{\"id\":\"d0f52e80b4f985e0\",\"type\":\"change\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Reset\",\"rules\":[{\"t\":\"set\",\"p\":\"reset\",\"pt\":\"msg\",\"to\":\"true\",\"tot\":\"bool\"}],\"action\":\"\",\"property\":\"\",\"from\":\"\",\"to\":\"\",\"reg\":false,\"x\":1430,\"y\":1020,\"wires\":[[\"2edd37d95f8da095\",\"e453f5396d7ade80\"]]},{\"id\":\"e9d184371b445d91\",\"type\":\"delay\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Maximum 1 per 1 second(s)\",\"pauseType\":\"rate\",\"timeout\":\"5\",\"timeoutUnits\":\"seconds\",\"rate\":\"1\",\"nbRateUnits\":\"1\",\"rateUnits\":\"second\",\"randomFirst\":\"1\",\"randomLast\":\"5\",\"randomUnits\":\"seconds\",\"drop\":true,\"allowrate\":true,\"outputs\":1,\"x\":470,\"y\":100,\"wires\":[[\"5b42f717a84ae8e1\"]]},{\"id\":\"2396d678c51f07e1\",\"type\":\"switch\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Check Status Code\",\"property\":\"statusCode\",\"propertyType\":\"msg\",\"rules\":[{\"t\":\"eq\",\"v\":\"200\",\"vt\":\"num\"},{\"t\":\"else\"}],\"checkall\":\"true\",\"repair\":false,\"outputs\":2,\"x\":890,\"y\":100,\"wires\":[[\"384128d5d75a8c8e\",\"193d8d9d89153d32\",\"30fb9c2a26d1c6bc\"],[\"21057ddd5151fd0a\"]]},{\"id\":\"21057ddd5151fd0a\",\"type\":\"change\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Change Rate Limit to 1/5min\",\"rules\":[{\"t\":\"delete\",\"p\":\"payload\",\"pt\":\"msg\"},{\"t\":\"set\",\"p\":\"rate\",\"pt\":\"msg\",\"to\":\"300000\",\"tot\":\"num\"},{\"t\":\"set\",\"p\":\"payload.state\",\"pt\":\"msg\",\"to\":\"true\",\"tot\":\"bool\"}],\"action\":\"\",\"property\":\"\",\"from\":\"\",\"to\":\"\",\"reg\":false,\"x\":1060,\"y\":180,\"wires\":[[\"e9d184371b445d91\",\"a7839f383614bfc2\"]],\"info\":\"Lower the rate limit if the device appears to be offline. There can be issues with requests queuing up and then bombarding the device all at once.\"},{\"id\":\"384128d5d75a8c8e\",\"type\":\"change\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Change Rate Limit to 1/1s\",\"rules\":[{\"t\":\"delete\",\"p\":\"payload\",\"pt\":\"msg\"},{\"t\":\"set\",\"p\":\"rate\",\"pt\":\"msg\",\"to\":\"1000\",\"tot\":\"num\"},{\"t\":\"set\",\"p\":\"payload.state\",\"pt\":\"msg\",\"to\":\"false\",\"tot\":\"bool\"}],\"action\":\"\",\"property\":\"\",\"from\":\"\",\"to\":\"\",\"reg\":false,\"x\":1130,\"y\":40,\"wires\":[[\"e9d184371b445d91\",\"a7839f383614bfc2\"]],\"info\":\"The rate limit is set to 1s because the device is naive and will block all requests if too many requests are sent per second (this can happen if for example if the status worker queues a request every second but the request takes more than 1 second to complete (resulting in multiple requests hitting the device at a time)).\"},{\"id\":\"a7839f383614bfc2\",\"type\":\"ha-binary-sensor\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Hot Water System Fault\",\"entityConfig\":\"1f0b4dda838ff26f\",\"version\":0,\"state\":\"payload\",\"stateType\":\"msg\",\"attributes\":[],\"inputOverride\":\"allow\",\"outputProperties\":[],\"x\":1650,\"y\":180,\"wires\":[[]]},{\"id\":\"51cf436bbd7cbaf4\",\"type\":\"ha-number\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Hot Water Temperature\",\"version\":1,\"debugenabled\":false,\"inputs\":0,\"outputs\":1,\"entityConfig\":\"45814c1df11da288\",\"mode\":\"listen\",\"value\":\"payload\",\"valueType\":\"msg\",\"outputProperties\":[{\"property\":\"payload\",\"propertyType\":\"msg\",\"value\":\"\",\"valueType\":\"value\"}],\"x\":200,\"y\":340,\"wires\":[[\"c49192547f6f2c1c\"]]},{\"id\":\"e05abb2bfb924b50\",\"type\":\"ha-sensor\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Hot Water Current Temperature\",\"entityConfig\":\"8f5d41d1249b7816\",\"version\":0,\"state\":\"payload.temp\",\"stateType\":\"msg\",\"attributes\":[],\"inputOverride\":\"allow\",\"outputProperties\":[],\"x\":1650,\"y\":100,\"wires\":[[]]},{\"id\":\"508645f10065beeb\",\"type\":\"ha-sensor\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Hot Water Flow\",\"entityConfig\":\"1ce788ad9baaf0e1\",\"version\":0,\"state\":\"payload.flow\",\"stateType\":\"msg\",\"attributes\":[],\"inputOverride\":\"block\",\"outputProperties\":[],\"x\":1580,\"y\":40,\"wires\":[[]]},{\"id\":\"193d8d9d89153d32\",\"type\":\"change\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Rewrite Msg\",\"rules\":[{\"t\":\"set\",\"p\":\"payload.state\",\"pt\":\"msg\",\"to\":\"payload.flow\",\"tot\":\"msg\"}],\"action\":\"\",\"property\":\"\",\"from\":\"\",\"to\":\"\",\"reg\":false,\"x\":1290,\"y\":80,\"wires\":[[\"508645f10065beeb\"]]},{\"id\":\"30fb9c2a26d1c6bc\",\"type\":\"change\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Rewrite Msg\",\"rules\":[{\"t\":\"set\",\"p\":\"payload.state\",\"pt\":\"msg\",\"to\":\"payload.temp\",\"tot\":\"msg\"}],\"action\":\"\",\"property\":\"\",\"from\":\"\",\"to\":\"\",\"reg\":false,\"x\":1290,\"y\":140,\"wires\":[[\"e05abb2bfb924b50\"]]},{\"id\":\"bac57b6064eedf90\",\"type\":\"switch\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Compare Requested and Current\",\"property\":\"payload\",\"propertyType\":\"msg\",\"rules\":[{\"t\":\"eq\",\"v\":\"current_temperature\",\"vt\":\"msg\"},{\"t\":\"else\"}],\"checkall\":\"true\",\"repair\":false,\"outputs\":2,\"x\":740,\"y\":340,\"wires\":[[],[\"ab64e497209d9b70\"]]},{\"id\":\"c49192547f6f2c1c\",\"type\":\"api-current-state\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Check Current Temperature\",\"server\":\"f1028730287dd073\",\"version\":3,\"outputs\":1,\"halt_if\":\"\",\"halt_if_type\":\"str\",\"halt_if_compare\":\"is\",\"entity_id\":\"sensor.hot_water_current_temperature\",\"state_type\":\"str\",\"blockInputOverrides\":false,\"outputProperties\":[{\"property\":\"current_temperature\",\"propertyType\":\"msg\",\"value\":\"\",\"valueType\":\"entityState\"}],\"for\":\"0\",\"forType\":\"num\",\"forUnits\":\"minutes\",\"override_topic\":false,\"state_location\":\"payload\",\"override_payload\":\"msg\",\"entity_location\":\"data\",\"override_data\":\"msg\",\"x\":460,\"y\":340,\"wires\":[[\"bac57b6064eedf90\"]]},{\"id\":\"3462a5e5c5120024\",\"type\":\"ha-number\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Hot Water Default Temperature\",\"version\":1,\"debugenabled\":false,\"inputs\":0,\"outputs\":1,\"entityConfig\":\"8660e8bc5b0a715e\",\"mode\":\"listen\",\"value\":\"payload\",\"valueType\":\"msg\",\"outputProperties\":[{\"property\":\"payload\",\"propertyType\":\"msg\",\"value\":\"\",\"valueType\":\"value\"},{\"property\":\"previousValue\",\"propertyType\":\"msg\",\"value\":\"\",\"valueType\":\"previousValue\"}],\"x\":210,\"y\":640,\"wires\":[[\"fb4de64eada90c7f\"]]},{\"id\":\"fb4de64eada90c7f\",\"type\":\"change\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Set flow.default_temperature\",\"rules\":[{\"t\":\"set\",\"p\":\"default_temperature\",\"pt\":\"flow\",\"to\":\"payload\",\"tot\":\"msg\"}],\"action\":\"\",\"property\":\"\",\"from\":\"\",\"to\":\"\",\"reg\":false,\"x\":660,\"y\":640,\"wires\":[[\"c95a99d6cb4e8061\"]]},{\"id\":\"b59baed7a9f31063\",\"type\":\"ha-number\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Hot Water Timeout\",\"version\":1,\"debugenabled\":false,\"inputs\":0,\"outputs\":1,\"entityConfig\":\"8d8d8a2ce2269de0\",\"mode\":\"listen\",\"value\":\"payload\",\"valueType\":\"msg\",\"outputProperties\":[{\"property\":\"payload\",\"propertyType\":\"msg\",\"value\":\"\",\"valueType\":\"value\"}],\"x\":170,\"y\":720,\"wires\":[[\"76b7c7aa0a8ad2de\"]]},{\"id\":\"76b7c7aa0a8ad2de\",\"type\":\"function\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Convert to milliseconds\",\"func\":\"msg.payload = msg.payload * 60 * 1000;\\nreturn msg;\",\"outputs\":1,\"timeout\":\"\",\"noerr\":0,\"initialize\":\"\",\"finalize\":\"\",\"libs\":[],\"x\":690,\"y\":720,\"wires\":[[\"04e4f3819fda56d7\"]]},{\"id\":\"04e4f3819fda56d7\",\"type\":\"change\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Set flow.delay\",\"rules\":[{\"t\":\"set\",\"p\":\"delay\",\"pt\":\"flow\",\"to\":\"payload\",\"tot\":\"msg\"}],\"action\":\"\",\"property\":\"\",\"from\":\"\",\"to\":\"\",\"reg\":false,\"x\":920,\"y\":720,\"wires\":[[]]},{\"id\":\"c95a99d6cb4e8061\",\"type\":\"api-call-service\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Set Temperature to Default\",\"server\":\"f1028730287dd073\",\"version\":5,\"debugenabled\":false,\"domain\":\"number\",\"service\":\"set_value\",\"areaId\":[],\"deviceId\":[],\"entityId\":[\"number.hot_water_temperature\"],\"data\":\"{ \\\"value\\\": payload }\",\"dataType\":\"jsonata\",\"mergeContext\":\"\",\"mustacheAltTags\":false,\"outputProperties\":[],\"queue\":\"none\",\"x\":940,\"y\":640,\"wires\":[[]]},{\"id\":\"2cdefe2e3a3c1b76\",\"type\":\"inject\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Run Once on Startup\",\"props\":[{\"p\":\"payload\"}],\"repeat\":\"\",\"crontab\":\"\",\"once\":true,\"onceDelay\":\"10\",\"topic\":\"\",\"payload\":\"\",\"payloadType\":\"date\",\"x\":200,\"y\":780,\"wires\":[[\"6a835e9ed6f964c6\"]]},{\"id\":\"6a835e9ed6f964c6\",\"type\":\"api-current-state\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Get Hot Water Timeout\",\"server\":\"f1028730287dd073\",\"version\":3,\"outputs\":1,\"halt_if\":\"\",\"halt_if_type\":\"str\",\"halt_if_compare\":\"is\",\"entity_id\":\"number.hot_water_timeout\",\"state_type\":\"str\",\"blockInputOverrides\":false,\"outputProperties\":[{\"property\":\"payload\",\"propertyType\":\"msg\",\"value\":\"\",\"valueType\":\"entityState\"}],\"for\":\"0\",\"forType\":\"num\",\"forUnits\":\"minutes\",\"override_topic\":false,\"state_location\":\"payload\",\"override_payload\":\"msg\",\"entity_location\":\"data\",\"override_data\":\"msg\",\"x\":420,\"y\":780,\"wires\":[[\"76b7c7aa0a8ad2de\"]]},{\"id\":\"6f5879b3c824d8c1\",\"type\":\"inject\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Run Once on Startup\",\"props\":[{\"p\":\"payload\"}],\"repeat\":\"\",\"crontab\":\"\",\"once\":true,\"onceDelay\":\"10\",\"topic\":\"\",\"payload\":\"\",\"payloadType\":\"date\",\"x\":180,\"y\":580,\"wires\":[[\"1ad6d0113da91aee\"]]},{\"id\":\"1ad6d0113da91aee\",\"type\":\"api-current-state\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Get Hot Water Default Temperature\",\"server\":\"f1028730287dd073\",\"version\":3,\"outputs\":1,\"halt_if\":\"\",\"halt_if_type\":\"str\",\"halt_if_compare\":\"is\",\"entity_id\":\"number.hot_water_default_temperature\",\"state_type\":\"str\",\"blockInputOverrides\":false,\"outputProperties\":[{\"property\":\"payload\",\"propertyType\":\"msg\",\"value\":\"\",\"valueType\":\"entityState\"}],\"for\":\"0\",\"forType\":\"num\",\"forUnits\":\"minutes\",\"override_topic\":false,\"state_location\":\"payload\",\"override_payload\":\"msg\",\"entity_location\":\"data\",\"override_data\":\"msg\",\"x\":440,\"y\":580,\"wires\":[[\"fb4de64eada90c7f\"]]},{\"id\":\"042514a7082e23c7\",\"type\":\"api-current-state\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Get Current Flow\",\"server\":\"f1028730287dd073\",\"version\":3,\"outputs\":1,\"halt_if\":\"\",\"halt_if_type\":\"str\",\"halt_if_compare\":\"is\",\"entity_id\":\"sensor.hot_water_flow\",\"state_type\":\"num\",\"blockInputOverrides\":false,\"outputProperties\":[{\"property\":\"flow\",\"propertyType\":\"msg\",\"value\":\"\",\"valueType\":\"entityState\"}],\"for\":\"0\",\"forType\":\"num\",\"forUnits\":\"minutes\",\"override_topic\":false,\"state_location\":\"payload\",\"override_payload\":\"msg\",\"entity_location\":\"data\",\"override_data\":\"msg\",\"x\":1490,\"y\":340,\"wires\":[[\"2db0d4223a2f0ec1\"]],\"info\":\"This makes the loop wait until the requested temp = current temp (otherwise the temperature change worker is likely still operating)\"},{\"id\":\"2db0d4223a2f0ec1\",\"type\":\"switch\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Check if Flow is 0\",\"property\":\"flow\",\"propertyType\":\"msg\",\"rules\":[{\"t\":\"eq\",\"v\":\"0\",\"vt\":\"num\"},{\"t\":\"else\"}],\"checkall\":\"true\",\"repair\":false,\"outputs\":2,\"x\":1750,\"y\":340,\"wires\":[[\"9e45702398f76732\"],[\"2e9dec374b153988\"]]},{\"id\":\"2e9dec374b153988\",\"type\":\"delay\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Wait 5 Seconds and Recheck\",\"pauseType\":\"delay\",\"timeout\":\"5\",\"timeoutUnits\":\"seconds\",\"rate\":\"1\",\"nbRateUnits\":\"1\",\"rateUnits\":\"second\",\"randomFirst\":\"1\",\"randomLast\":\"5\",\"randomUnits\":\"seconds\",\"drop\":false,\"allowrate\":false,\"outputs\":1,\"x\":1620,\"y\":260,\"wires\":[[\"042514a7082e23c7\"]]},{\"id\":\"8ed1f3b56286ca70\",\"type\":\"inject\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Reset\",\"props\":[{\"p\":\"reset\",\"v\":\"true\",\"vt\":\"bool\"}],\"repeat\":\"\",\"crontab\":\"\",\"once\":false,\"onceDelay\":0.1,\"topic\":\"\",\"x\":1350,\"y\":260,\"wires\":[[\"2e9dec374b153988\"]]},{\"id\":\"84f7eb2439a04beb\",\"type\":\"api-current-state\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Check Flow\",\"server\":\"f1028730287dd073\",\"version\":3,\"outputs\":2,\"halt_if\":\"0\",\"halt_if_type\":\"num\",\"halt_if_compare\":\"is\",\"entity_id\":\"sensor.hot_water_flow\",\"state_type\":\"num\",\"blockInputOverrides\":false,\"outputProperties\":[],\"for\":\"delay\",\"forType\":\"flow\",\"forUnits\":\"milliseconds\",\"override_topic\":false,\"state_location\":\"payload\",\"override_payload\":\"msg\",\"entity_location\":\"data\",\"override_data\":\"msg\",\"x\":450,\"y\":880,\"wires\":[[\"8078e213ff20ebe9\"],[]]},{\"id\":\"7c97616ad0acbe51\",\"type\":\"server-state-changed\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Automation - Hot Water Timeout\",\"server\":\"f1028730287dd073\",\"version\":5,\"outputs\":2,\"exposeAsEntityConfig\":\"020edd2b2bd16f44\",\"entityId\":\"number.hot_water_temperature\",\"entityIdType\":\"exact\",\"outputInitially\":false,\"stateType\":\"num\",\"ifState\":\"default_temperature\",\"ifStateType\":\"flow\",\"ifStateOperator\":\"is_not\",\"outputOnlyOnStateChange\":true,\"for\":\"delay\",\"forType\":\"flow\",\"forUnits\":\"milliseconds\",\"ignorePrevStateNull\":false,\"ignorePrevStateUnknown\":false,\"ignorePrevStateUnavailable\":false,\"ignoreCurrentStateUnknown\":false,\"ignoreCurrentStateUnavailable\":false,\"outputProperties\":[{\"property\":\"default_temperature\",\"propertyType\":\"msg\",\"value\":\"default_temperature\",\"valueType\":\"flow\"}],\"x\":210,\"y\":880,\"wires\":[[\"84f7eb2439a04beb\"],[]]},{\"id\":\"f1028730287dd073\",\"type\":\"server\",\"name\":\"Home Assistant\",\"version\":5,\"addon\":true,\"rejectUnauthorizedCerts\":true,\"ha_boolean\":\"y|yes|true|on|home|open\",\"connectionDelay\":true,\"cacheJson\":true,\"heartbeat\":false,\"heartbeatInterval\":\"30\",\"areaSelector\":\"friendlyName\",\"deviceSelector\":\"friendlyName\",\"entitySelector\":\"friendlyName\",\"statusSeparator\":\"at: \",\"statusYear\":\"hidden\",\"statusMonth\":\"short\",\"statusDay\":\"numeric\",\"statusHourCycle\":\"h23\",\"statusTimeFormat\":\"h:m\",\"enableGlobalContextStore\":true},{\"id\":\"1f0b4dda838ff26f\",\"type\":\"ha-entity-config\",\"server\":\"f1028730287dd073\",\"deviceConfig\":\"ac4d05f67b79f774\",\"name\":\"Binary Sensor for Hot Water System Fault\",\"version\":\"6\",\"entityType\":\"binary_sensor\",\"haConfig\":[{\"property\":\"name\",\"value\":\"Hot Water System Fault\"},{\"property\":\"icon\",\"value\":\"\"},{\"property\":\"entity_category\",\"value\":\"diagnostic\"},{\"property\":\"entity_picture\",\"value\":\"\"},{\"property\":\"device_class\",\"value\":\"problem\"}],\"resend\":false,\"debugEnabled\":false},{\"id\":\"45814c1df11da288\",\"type\":\"ha-entity-config\",\"server\":\"f1028730287dd073\",\"deviceConfig\":\"ac4d05f67b79f774\",\"name\":\"Number for Hot Water Temperature\",\"version\":\"6\",\"entityType\":\"number\",\"haConfig\":[{\"property\":\"name\",\"value\":\"Hot Water Temperature\"},{\"property\":\"icon\",\"value\":\"mdi:kettle-steam-outline\"},{\"property\":\"entity_category\",\"value\":\"\"},{\"property\":\"entity_picture\",\"value\":\"\"},{\"property\":\"device_class\",\"value\":\"temperature\"},{\"property\":\"unit_of_measurement\",\"value\":\"\u00b0C\"},{\"property\":\"min_value\",\"value\":37},{\"property\":\"max_value\",\"value\":50},{\"property\":\"step_value\",\"value\":1},{\"property\":\"mode\",\"value\":\"auto\"}],\"resend\":false,\"debugEnabled\":false},{\"id\":\"8f5d41d1249b7816\",\"type\":\"ha-entity-config\",\"server\":\"f1028730287dd073\",\"deviceConfig\":\"ac4d05f67b79f774\",\"name\":\"Sensor Config for Hot Water Current Temperature\",\"version\":\"6\",\"entityType\":\"sensor\",\"haConfig\":[{\"property\":\"name\",\"value\":\"Hot Water Current Temperature\"},{\"property\":\"icon\",\"value\":\"\"},{\"property\":\"entity_category\",\"value\":\"\"},{\"property\":\"entity_picture\",\"value\":\"\"},{\"property\":\"device_class\",\"value\":\"temperature\"},{\"property\":\"unit_of_measurement\",\"value\":\"\u00b0C\"},{\"property\":\"state_class\",\"value\":\"measurement\"}],\"resend\":false,\"debugEnabled\":false},{\"id\":\"1ce788ad9baaf0e1\",\"type\":\"ha-entity-config\",\"server\":\"f1028730287dd073\",\"deviceConfig\":\"ac4d05f67b79f774\",\"name\":\"Sensor Config for Hot Water Flow\",\"version\":\"6\",\"entityType\":\"sensor\",\"haConfig\":[{\"property\":\"name\",\"value\":\"Hot Water Flow\"},{\"property\":\"icon\",\"value\":\"mdi:faucet\"},{\"property\":\"entity_category\",\"value\":\"\"},{\"property\":\"entity_picture\",\"value\":\"\"},{\"property\":\"device_class\",\"value\":\"\"},{\"property\":\"unit_of_measurement\",\"value\":\"L/min\"},{\"property\":\"state_class\",\"value\":\"measurement\"}],\"resend\":false,\"debugEnabled\":false},{\"id\":\"8660e8bc5b0a715e\",\"type\":\"ha-entity-config\",\"server\":\"f1028730287dd073\",\"deviceConfig\":\"ac4d05f67b79f774\",\"name\":\"Number Config for Hot Water Default Temperature\",\"version\":\"6\",\"entityType\":\"number\",\"haConfig\":[{\"property\":\"name\",\"value\":\"Hot Water Default Temperature\"},{\"property\":\"icon\",\"value\":\"mdi:thermometer-chevron-down\"},{\"property\":\"entity_picture\",\"value\":\"\"},{\"property\":\"entity_category\",\"value\":\"config\"},{\"property\":\"device_class\",\"value\":\"temperature\"},{\"property\":\"unit_of_measurement\",\"value\":\"\u00b0C\"},{\"property\":\"min_value\",\"value\":37},{\"property\":\"max_value\",\"value\":50},{\"property\":\"step_value\",\"value\":1},{\"property\":\"mode\",\"value\":\"auto\"}],\"resend\":false,\"debugEnabled\":false},{\"id\":\"8d8d8a2ce2269de0\",\"type\":\"ha-entity-config\",\"server\":\"f1028730287dd073\",\"deviceConfig\":\"ac4d05f67b79f774\",\"name\":\"Number for Hot Water Timeout\",\"version\":\"6\",\"entityType\":\"number\",\"haConfig\":[{\"property\":\"name\",\"value\":\"Hot Water Timeout\"},{\"property\":\"icon\",\"value\":\"mdi:timer\"},{\"property\":\"entity_picture\",\"value\":\"\"},{\"property\":\"entity_category\",\"value\":\"config\"},{\"property\":\"device_class\",\"value\":\"\"},{\"property\":\"unit_of_measurement\",\"value\":\"min\"},{\"property\":\"min_value\",\"value\":1},{\"property\":\"max_value\",\"value\":60},{\"property\":\"step_value\",\"value\":1},{\"property\":\"mode\",\"value\":\"box\"}],\"resend\":false,\"debugEnabled\":false},{\"id\":\"020edd2b2bd16f44\",\"type\":\"ha-entity-config\",\"server\":\"f1028730287dd073\",\"deviceConfig\":\"ac4d05f67b79f774\",\"name\":\"exposed as for Automation - Hot Water Timeout\",\"version\":\"6\",\"entityType\":\"switch\",\"haConfig\":[{\"property\":\"name\",\"value\":\"Automation - Hot Water Timeout\"},{\"property\":\"icon\",\"value\":\"mdi:timer-cancel\"},{\"property\":\"entity_category\",\"value\":\"config\"},{\"property\":\"entity_picture\",\"value\":\"\"},{\"property\":\"device_class\",\"value\":\"\"}],\"resend\":false,\"debugEnabled\":false},{\"id\":\"ac4d05f67b79f774\",\"type\":\"ha-device-config\",\"name\":\"Rheem Hot Water System\",\"hwVersion\":\"\",\"manufacturer\":\"Rheem\",\"model\":\"\",\"swVersion\":\"\"}]\n</code></pre>"},{"location":"ha/#node-red-flow-optional-google-home-siri-components","title":"Node-Red Flow (Optional Google Home/ Siri Components)","text":"<p>Import this onto the same flow as the above.</p> Node-Red Flow (Optional Google Home/ Siri Components)<pre><code>[{\"id\":\"65619639265cf5ea\",\"type\":\"api-call-service\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Set Water Hot\",\"server\":\"f1028730287dd073\",\"version\":5,\"debugenabled\":false,\"domain\":\"number\",\"service\":\"set_value\",\"areaId\":[],\"deviceId\":[],\"entityId\":[\"number.hot_water_temperature\"],\"data\":\"{\\\"value\\\":payload}\",\"dataType\":\"jsonata\",\"mergeContext\":\"\",\"mustacheAltTags\":false,\"outputProperties\":[],\"queue\":\"none\",\"x\":1160,\"y\":1300,\"wires\":[[]]},{\"id\":\"741797cf63baafe2\",\"type\":\"api-call-service\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Set Water Normal\",\"server\":\"f1028730287dd073\",\"version\":5,\"debugenabled\":false,\"domain\":\"number\",\"service\":\"set_value\",\"areaId\":[],\"deviceId\":[],\"entityId\":[\"number.hot_water_temperature\"],\"data\":\"{ \\\"value\\\" : payload }\",\"dataType\":\"jsonata\",\"mergeContext\":\"\",\"mustacheAltTags\":false,\"outputProperties\":[],\"queue\":\"none\",\"x\":1170,\"y\":1360,\"wires\":[[]]},{\"id\":\"02ded775b14645ca\",\"type\":\"switch\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Check Temp\",\"property\":\"payload\",\"propertyType\":\"msg\",\"rules\":[{\"t\":\"lte\",\"v\":\"default_temperature\",\"vt\":\"flow\"},{\"t\":\"gte\",\"v\":\"ga_hot_temperature\",\"vt\":\"flow\"},{\"t\":\"else\"}],\"checkall\":\"false\",\"repair\":false,\"outputs\":3,\"x\":630,\"y\":1440,\"wires\":[[\"4e7cfaf142737137\"],[\"0894899f5f2d3261\"],[]]},{\"id\":\"2aa646efaaf4bad9\",\"type\":\"inject\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Hot Water Switch Update Worker\",\"props\":[{\"p\":\"payload\"}],\"repeat\":\"5\",\"crontab\":\"\",\"once\":true,\"onceDelay\":0.1,\"topic\":\"\",\"payload\":\"\",\"payloadType\":\"date\",\"x\":260,\"y\":1440,\"wires\":[[\"cc50e38cf7f45292\"]]},{\"id\":\"cc50e38cf7f45292\",\"type\":\"api-current-state\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Get State\",\"server\":\"f1028730287dd073\",\"version\":3,\"outputs\":1,\"halt_if\":\"\",\"halt_if_type\":\"str\",\"halt_if_compare\":\"is\",\"entity_id\":\"number.hot_water_temperature\",\"state_type\":\"str\",\"blockInputOverrides\":false,\"outputProperties\":[{\"property\":\"payload\",\"propertyType\":\"msg\",\"value\":\"\",\"valueType\":\"entityState\"}],\"for\":\"0\",\"forType\":\"num\",\"forUnits\":\"minutes\",\"override_topic\":false,\"state_location\":\"payload\",\"override_payload\":\"msg\",\"entity_location\":\"data\",\"override_data\":\"msg\",\"x\":480,\"y\":1440,\"wires\":[[\"02ded775b14645ca\"]]},{\"id\":\"4e7cfaf142737137\",\"type\":\"api-current-state\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Get Switch State\",\"server\":\"f1028730287dd073\",\"version\":3,\"outputs\":2,\"halt_if\":\"on\",\"halt_if_type\":\"str\",\"halt_if_compare\":\"is\",\"entity_id\":\"switch.hot_water\",\"state_type\":\"str\",\"blockInputOverrides\":false,\"outputProperties\":[{\"property\":\"payload\",\"propertyType\":\"msg\",\"value\":\"\",\"valueType\":\"entityState\"}],\"for\":\"0\",\"forType\":\"num\",\"forUnits\":\"minutes\",\"override_topic\":false,\"state_location\":\"payload\",\"override_payload\":\"msg\",\"entity_location\":\"data\",\"override_data\":\"msg\",\"x\":830,\"y\":1420,\"wires\":[[\"e5ebe23f84a26b15\"],[]]},{\"id\":\"8103ab9894b106a7\",\"type\":\"api-call-service\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Turn off Switch\",\"server\":\"f1028730287dd073\",\"version\":5,\"debugenabled\":false,\"domain\":\"switch\",\"service\":\"turn_off\",\"areaId\":[],\"deviceId\":[],\"entityId\":[\"switch.hot_water\"],\"data\":\"\",\"dataType\":\"jsonata\",\"mergeContext\":\"\",\"mustacheAltTags\":false,\"outputProperties\":[],\"queue\":\"none\",\"x\":1300,\"y\":1420,\"wires\":[[\"a12a4ea3cf6f74c8\"]]},{\"id\":\"1d92721dc5c2d73e\",\"type\":\"ha-switch\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Hot Water Switch - Google Helper\",\"version\":0,\"inputs\":1,\"outputs\":2,\"entityConfig\":\"5ac0a59db72278da\",\"enableInput\":true,\"outputOnStateChange\":true,\"outputProperties\":[{\"property\":\"payload\",\"propertyType\":\"msg\",\"value\":\"$entity().state ? \\\"on\\\": \\\"off\\\"\",\"valueType\":\"jsonata\"}],\"x\":220,\"y\":1320,\"wires\":[[\"0a07992ba542fdfe\"],[\"b8d4ad85feb2585b\"]],\"info\":\"Google Home/ Assistant doesn't currently allow number inputs. This allows switching between two hot and normal using Google devices.\"},{\"id\":\"b58efdd7978d22ca\",\"type\":\"change\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Set payload to flow.default_temperature\",\"rules\":[{\"t\":\"set\",\"p\":\"payload\",\"pt\":\"msg\",\"to\":\"default_temperature\",\"tot\":\"flow\"}],\"action\":\"\",\"property\":\"\",\"from\":\"\",\"to\":\"\",\"reg\":false,\"x\":880,\"y\":1360,\"wires\":[[\"741797cf63baafe2\"]]},{\"id\":\"0894899f5f2d3261\",\"type\":\"api-current-state\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Get Switch State\",\"server\":\"f1028730287dd073\",\"version\":3,\"outputs\":2,\"halt_if\":\"off\",\"halt_if_type\":\"str\",\"halt_if_compare\":\"is\",\"entity_id\":\"switch.hot_water\",\"state_type\":\"str\",\"blockInputOverrides\":false,\"outputProperties\":[{\"property\":\"payload\",\"propertyType\":\"msg\",\"value\":\"\",\"valueType\":\"entityState\"}],\"for\":\"0\",\"forType\":\"num\",\"forUnits\":\"minutes\",\"override_topic\":false,\"state_location\":\"payload\",\"override_payload\":\"msg\",\"entity_location\":\"data\",\"override_data\":\"msg\",\"x\":830,\"y\":1480,\"wires\":[[\"dbdca9f51c06b445\"],[]]},{\"id\":\"8f9fb0f0f96e626e\",\"type\":\"api-call-service\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Turn on Switch\",\"server\":\"f1028730287dd073\",\"version\":5,\"debugenabled\":false,\"domain\":\"switch\",\"service\":\"turn_on\",\"areaId\":[],\"deviceId\":[],\"entityId\":[\"switch.hot_water\"],\"data\":\"\",\"dataType\":\"jsonata\",\"mergeContext\":\"\",\"mustacheAltTags\":false,\"outputProperties\":[],\"queue\":\"none\",\"x\":1300,\"y\":1480,\"wires\":[[\"e8ed2fbb661c9e1e\"]]},{\"id\":\"437e01bd717d10f1\",\"type\":\"ha-number\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Hot Water Google Assistant Hot Temperature\",\"version\":1,\"debugenabled\":false,\"inputs\":0,\"outputs\":1,\"entityConfig\":\"d7a35d4246adf20c\",\"mode\":\"listen\",\"value\":\"payload\",\"valueType\":\"msg\",\"outputProperties\":[{\"property\":\"payload\",\"propertyType\":\"msg\",\"value\":\"\",\"valueType\":\"value\"}],\"x\":250,\"y\":1220,\"wires\":[[\"0d31ba78cc822680\"]]},{\"id\":\"0d31ba78cc822680\",\"type\":\"change\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Set flow.ga_hot_temperature\",\"rules\":[{\"t\":\"set\",\"p\":\"ga_hot_temperature\",\"pt\":\"flow\",\"to\":\"payload\",\"tot\":\"msg\"}],\"action\":\"\",\"property\":\"\",\"from\":\"\",\"to\":\"\",\"reg\":false,\"x\":660,\"y\":1220,\"wires\":[[]]},{\"id\":\"519efd6c76a4d5ce\",\"type\":\"inject\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Run Once on Startup\",\"props\":[{\"p\":\"payload\"}],\"repeat\":\"\",\"crontab\":\"\",\"once\":true,\"onceDelay\":\"10\",\"topic\":\"\",\"payload\":\"\",\"payloadType\":\"date\",\"x\":180,\"y\":1160,\"wires\":[[\"fdc1ab0543682c70\"]]},{\"id\":\"fdc1ab0543682c70\",\"type\":\"api-current-state\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Get Hot Water Google Assistant Hot Temperature\",\"server\":\"f1028730287dd073\",\"version\":3,\"outputs\":1,\"halt_if\":\"\",\"halt_if_type\":\"str\",\"halt_if_compare\":\"is\",\"entity_id\":\"number.hot_water_google_assistant_hot_temperature\",\"state_type\":\"str\",\"blockInputOverrides\":false,\"outputProperties\":[{\"property\":\"payload\",\"propertyType\":\"msg\",\"value\":\"\",\"valueType\":\"entityState\"}],\"for\":\"0\",\"forType\":\"num\",\"forUnits\":\"minutes\",\"override_topic\":false,\"state_location\":\"payload\",\"override_payload\":\"msg\",\"entity_location\":\"data\",\"override_data\":\"msg\",\"x\":490,\"y\":1160,\"wires\":[[\"0d31ba78cc822680\"]]},{\"id\":\"afb8b51eb801ea92\",\"type\":\"change\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Set payload to flow.ga_hot_temperature\",\"rules\":[{\"t\":\"set\",\"p\":\"payload\",\"pt\":\"msg\",\"to\":\"ga_hot_temperature\",\"tot\":\"flow\"}],\"action\":\"\",\"property\":\"\",\"from\":\"\",\"to\":\"\",\"reg\":false,\"x\":880,\"y\":1300,\"wires\":[[\"65619639265cf5ea\"]]},{\"id\":\"e5ebe23f84a26b15\",\"type\":\"change\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Set ga_ignore flag\",\"rules\":[{\"t\":\"set\",\"p\":\"ga_ignore\",\"pt\":\"flow\",\"to\":\"true\",\"tot\":\"bool\"}],\"action\":\"\",\"property\":\"\",\"from\":\"\",\"to\":\"\",\"reg\":false,\"x\":1050,\"y\":1420,\"wires\":[[\"8103ab9894b106a7\"]]},{\"id\":\"dbdca9f51c06b445\",\"type\":\"change\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Set ga_ignore flag\",\"rules\":[{\"t\":\"set\",\"p\":\"ga_ignore\",\"pt\":\"flow\",\"to\":\"true\",\"tot\":\"bool\"}],\"action\":\"\",\"property\":\"\",\"from\":\"\",\"to\":\"\",\"reg\":false,\"x\":1050,\"y\":1480,\"wires\":[[\"8f9fb0f0f96e626e\"]]},{\"id\":\"a12a4ea3cf6f74c8\",\"type\":\"change\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Unset ga_ignore flag\",\"rules\":[{\"t\":\"set\",\"p\":\"ga_ignore\",\"pt\":\"flow\",\"to\":\"false\",\"tot\":\"bool\"}],\"action\":\"\",\"property\":\"\",\"from\":\"\",\"to\":\"\",\"reg\":false,\"x\":1540,\"y\":1420,\"wires\":[[]]},{\"id\":\"e8ed2fbb661c9e1e\",\"type\":\"change\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Unset ga_ignore flag\",\"rules\":[{\"t\":\"set\",\"p\":\"ga_ignore\",\"pt\":\"flow\",\"to\":\"false\",\"tot\":\"bool\"}],\"action\":\"\",\"property\":\"\",\"from\":\"\",\"to\":\"\",\"reg\":false,\"x\":1540,\"y\":1480,\"wires\":[[]]},{\"id\":\"0a07992ba542fdfe\",\"type\":\"switch\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Check ga_ignore Flag\",\"property\":\"ga_ignore\",\"propertyType\":\"flow\",\"rules\":[{\"t\":\"false\"},{\"t\":\"else\"}],\"checkall\":\"true\",\"repair\":false,\"outputs\":2,\"x\":540,\"y\":1300,\"wires\":[[\"afb8b51eb801ea92\"],[]]},{\"id\":\"b8d4ad85feb2585b\",\"type\":\"switch\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Check ga_ignore Flag\",\"property\":\"ga_ignore\",\"propertyType\":\"flow\",\"rules\":[{\"t\":\"false\"},{\"t\":\"else\"}],\"checkall\":\"true\",\"repair\":false,\"outputs\":2,\"x\":540,\"y\":1360,\"wires\":[[\"b58efdd7978d22ca\"],[]]},{\"id\":\"f1028730287dd073\",\"type\":\"server\",\"name\":\"Home Assistant\",\"version\":5,\"addon\":true,\"rejectUnauthorizedCerts\":true,\"ha_boolean\":\"y|yes|true|on|home|open\",\"connectionDelay\":true,\"cacheJson\":true,\"heartbeat\":false,\"heartbeatInterval\":\"30\",\"areaSelector\":\"friendlyName\",\"deviceSelector\":\"friendlyName\",\"entitySelector\":\"friendlyName\",\"statusSeparator\":\"at: \",\"statusYear\":\"hidden\",\"statusMonth\":\"short\",\"statusDay\":\"numeric\",\"statusHourCycle\":\"h23\",\"statusTimeFormat\":\"h:m\",\"enableGlobalContextStore\":true},{\"id\":\"5ac0a59db72278da\",\"type\":\"ha-entity-config\",\"server\":\"f1028730287dd073\",\"deviceConfig\":\"ac4d05f67b79f774\",\"name\":\"switch config for Hot Water Switch - Google Helper\",\"version\":\"6\",\"entityType\":\"switch\",\"haConfig\":[{\"property\":\"name\",\"value\":\"Hot Water\"},{\"property\":\"icon\",\"value\":\"mdi:kettle-steam-outline\"},{\"property\":\"entity_category\",\"value\":\"\"},{\"property\":\"entity_picture\",\"value\":\"\"},{\"property\":\"device_class\",\"value\":\"\"}],\"resend\":true,\"debugEnabled\":false},{\"id\":\"d7a35d4246adf20c\",\"type\":\"ha-entity-config\",\"server\":\"f1028730287dd073\",\"deviceConfig\":\"ac4d05f67b79f774\",\"name\":\"Number Config for Hot Water Google Assistant Hot Temperature\",\"version\":\"6\",\"entityType\":\"number\",\"haConfig\":[{\"property\":\"name\",\"value\":\"Hot Water Google Assistant Hot Temperature\"},{\"property\":\"icon\",\"value\":\"mdi:thermometer-chevron-up\"},{\"property\":\"entity_picture\",\"value\":\"\"},{\"property\":\"entity_category\",\"value\":\"config\"},{\"property\":\"device_class\",\"value\":\"temperature\"},{\"property\":\"unit_of_measurement\",\"value\":\"\u00b0C\"},{\"property\":\"min_value\",\"value\":37},{\"property\":\"max_value\",\"value\":50},{\"property\":\"step_value\",\"value\":1},{\"property\":\"mode\",\"value\":\"auto\"}],\"resend\":false,\"debugEnabled\":false},{\"id\":\"ac4d05f67b79f774\",\"type\":\"ha-device-config\",\"name\":\"Rheem Hot Water System\",\"hwVersion\":\"\",\"manufacturer\":\"Rheem\",\"model\":\"\",\"swVersion\":\"\"}]\n</code></pre>"},{"location":"ha/#code-v10","title":"Code v1.0","text":""},{"location":"ha/#node-red-flow_1","title":"Node-Red Flow","text":"<p>Import the following flow into Node Red - do not forget to configure the IP addresses and the HA API integrations as relevant for you.</p> Node-Red Flow<pre><code>[{\"id\":\"35bc46e08a2a88b3\",\"type\":\"delay\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Wait for set timeout\",\"pauseType\":\"delayv\",\"timeout\":\"10\",\"timeoutUnits\":\"seconds\",\"rate\":\"1\",\"nbRateUnits\":\"30\",\"rateUnits\":\"second\",\"randomFirst\":\"1\",\"randomLast\":\"5\",\"randomUnits\":\"seconds\",\"drop\":true,\"allowrate\":false,\"outputs\":1,\"x\":1670,\"y\":880,\"wires\":[[\"8078e213ff20ebe9\"]]},{\"id\":\"959ae573c614ed1d\",\"type\":\"change\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Reset Loops\",\"rules\":[{\"t\":\"set\",\"p\":\"reset\",\"pt\":\"msg\",\"to\":\"reset\",\"tot\":\"str\"}],\"action\":\"\",\"property\":\"\",\"from\":\"\",\"to\":\"\",\"reg\":false,\"x\":1970,\"y\":980,\"wires\":[[\"35bc46e08a2a88b3\"]]},{\"id\":\"5b42f717a84ae8e1\",\"type\":\"http request\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Get Current Info\",\"method\":\"GET\",\"ret\":\"obj\",\"paytoqs\":\"ignore\",\"url\":\"http://XXX.XXX.XXX.XXX/getInfo.cgi\",\"tls\":\"\",\"persist\":false,\"proxy\":\"\",\"insecureHTTPParser\":false,\"authType\":\"\",\"senderr\":false,\"headers\":[],\"x\":700,\"y\":100,\"wires\":[[\"2396d678c51f07e1\"]]},{\"id\":\"b5f5f860f82d95f1\",\"type\":\"inject\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Status Update Worker\",\"props\":[{\"p\":\"payload\"}],\"repeat\":\"1\",\"crontab\":\"\",\"once\":true,\"onceDelay\":\"10\",\"topic\":\"\",\"payload\":\"\",\"payloadType\":\"date\",\"x\":210,\"y\":100,\"wires\":[[\"e9d184371b445d91\"]]},{\"id\":\"ab64e497209d9b70\",\"type\":\"change\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Store it in flow.temperature\",\"rules\":[{\"t\":\"set\",\"p\":\"temperature\",\"pt\":\"flow\",\"to\":\"payload\",\"tot\":\"msg\"}],\"action\":\"\",\"property\":\"\",\"from\":\"\",\"to\":\"\",\"reg\":false,\"x\":1040,\"y\":300,\"wires\":[[\"c3f6338723a63d68\"]]},{\"id\":\"eced634799386a54\",\"type\":\"http request\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Take Control of Rheem System\",\"method\":\"GET\",\"ret\":\"obj\",\"paytoqs\":\"ignore\",\"url\":\"http://XXX.XXX.XXX.XXX/ctrl.cgi?sid=0&amp;heatingCtrl=1\",\"tls\":\"\",\"persist\":false,\"proxy\":\"\",\"authType\":\"\",\"senderr\":false,\"x\":230,\"y\":440,\"wires\":[[\"9746d74387ecf508\"]]},{\"id\":\"9746d74387ecf508\",\"type\":\"switch\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Check if Error\",\"property\":\"payload.sid\",\"propertyType\":\"msg\",\"rules\":[{\"t\":\"eq\",\"v\":\"0\",\"vt\":\"str\"},{\"t\":\"else\"}],\"checkall\":\"true\",\"repair\":false,\"outputs\":2,\"x\":480,\"y\":440,\"wires\":[[],[\"b14b73714804ea04\"]]},{\"id\":\"b14b73714804ea04\",\"type\":\"change\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Store Session ID in flow.sid\",\"rules\":[{\"t\":\"set\",\"p\":\"sid\",\"pt\":\"flow\",\"to\":\"payload.sid\",\"tot\":\"msg\"}],\"action\":\"\",\"property\":\"\",\"from\":\"\",\"to\":\"\",\"reg\":false,\"x\":720,\"y\":440,\"wires\":[[\"0693e8ca6891c5db\"]]},{\"id\":\"0693e8ca6891c5db\",\"type\":\"function\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Setup the url\",\"func\":\"var t = flow.get(\\\"temperature\\\");\\nvar s = flow.get(\\\"sid\\\");\\n\\nmsg.url = \\\"http://XXX.XXX.XXX.XXX/set.cgi?sid=\\\" + s + \\\"&amp;setTemp=\\\" + t\\n\\nreturn msg;\",\"outputs\":1,\"noerr\":0,\"initialize\":\"\",\"finalize\":\"\",\"libs\":[],\"x\":930,\"y\":440,\"wires\":[[\"537a2e81dc41d614\"]]},{\"id\":\"537a2e81dc41d614\",\"type\":\"http request\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Request New Temp\",\"method\":\"GET\",\"ret\":\"obj\",\"paytoqs\":\"ignore\",\"url\":\"\",\"tls\":\"\",\"persist\":false,\"proxy\":\"\",\"authType\":\"\",\"senderr\":false,\"x\":1110,\"y\":440,\"wires\":[[\"74d1ee1c63cfa749\"]]},{\"id\":\"74d1ee1c63cfa749\",\"type\":\"switch\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Check for Error State\",\"property\":\"payload.reqtemp\",\"propertyType\":\"msg\",\"rules\":[{\"t\":\"eq\",\"v\":\"temperature\",\"vt\":\"flow\"},{\"t\":\"else\"}],\"checkall\":\"true\",\"repair\":false,\"outputs\":2,\"x\":1320,\"y\":440,\"wires\":[[\"51a197d8852cecb5\"],[\"d4d276c7a7a33b42\",\"62334558a9bb2eb5\",\"51a197d8852cecb5\"]]},{\"id\":\"62334558a9bb2eb5\",\"type\":\"debug\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Print Payload for Debugging\",\"active\":true,\"tosidebar\":true,\"console\":true,\"tostatus\":false,\"complete\":\"payload\",\"targetType\":\"msg\",\"statusVal\":\"\",\"statusType\":\"auto\",\"x\":1630,\"y\":520,\"wires\":[]},{\"id\":\"d4d276c7a7a33b42\",\"type\":\"debug\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Print encoded url for Debugging\",\"active\":true,\"tosidebar\":true,\"console\":true,\"tostatus\":false,\"complete\":\"url\",\"targetType\":\"msg\",\"statusVal\":\"\",\"statusType\":\"auto\",\"x\":1640,\"y\":560,\"wires\":[]},{\"id\":\"51a197d8852cecb5\",\"type\":\"delay\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Wait 1s\",\"pauseType\":\"delay\",\"timeout\":\"1\",\"timeoutUnits\":\"seconds\",\"rate\":\"1\",\"nbRateUnits\":\"1\",\"rateUnits\":\"second\",\"randomFirst\":\"1\",\"randomLast\":\"5\",\"randomUnits\":\"seconds\",\"drop\":false,\"allowrate\":false,\"outputs\":1,\"x\":1540,\"y\":440,\"wires\":[[\"ad81a1605da79aad\"]]},{\"id\":\"ad81a1605da79aad\",\"type\":\"function\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Setup the url\",\"func\":\"var s = flow.get(\\\"sid\\\");\\n\\nmsg.url = \\\"http://XXX.XXX.XXX.XXX/ctrl.cgi?sid=\\\" + s + \\\"&amp;heatingCtrl=0\\\"\\n\\nreturn msg;\",\"outputs\":1,\"noerr\":0,\"initialize\":\"\",\"finalize\":\"\",\"libs\":[],\"x\":1710,\"y\":440,\"wires\":[[\"a76078cb19481e28\"]]},{\"id\":\"a76078cb19481e28\",\"type\":\"http request\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Relinquish Control\",\"method\":\"GET\",\"ret\":\"obj\",\"paytoqs\":\"ignore\",\"url\":\"\",\"tls\":\"\",\"persist\":false,\"proxy\":\"\",\"authType\":\"\",\"senderr\":false,\"x\":1890,\"y\":440,\"wires\":[[\"9c423f42122a3e93\",\"ac8632db6b12bc0d\"]]},{\"id\":\"9c423f42122a3e93\",\"type\":\"switch\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Check for Error State\",\"property\":\"payload.sTimeout\",\"propertyType\":\"msg\",\"rules\":[{\"t\":\"eq\",\"v\":\"0\",\"vt\":\"str\"},{\"t\":\"else\"}],\"checkall\":\"true\",\"repair\":false,\"outputs\":2,\"x\":2100,\"y\":440,\"wires\":[[],[\"5d703d0aac38620e\",\"5d333b0168fd49af\"]]},{\"id\":\"5d703d0aac38620e\",\"type\":\"debug\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Print Payload for Debugging\",\"active\":true,\"tosidebar\":true,\"console\":true,\"tostatus\":false,\"complete\":\"payload\",\"targetType\":\"msg\",\"statusVal\":\"\",\"statusType\":\"auto\",\"x\":2070,\"y\":520,\"wires\":[]},{\"id\":\"5d333b0168fd49af\",\"type\":\"debug\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Print encoded url for Debugging\",\"active\":true,\"tosidebar\":true,\"console\":true,\"tostatus\":false,\"complete\":\"url\",\"targetType\":\"msg\",\"statusVal\":\"\",\"statusType\":\"auto\",\"x\":2080,\"y\":560,\"wires\":[]},{\"id\":\"d179e77ab80c9fe8\",\"type\":\"api-current-state\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Get Requested Temp\",\"server\":\"f1028730287dd073\",\"version\":3,\"outputs\":1,\"halt_if\":\"\",\"halt_if_type\":\"str\",\"halt_if_compare\":\"is\",\"entity_id\":\"number.hot_water_temperature\",\"state_type\":\"str\",\"blockInputOverrides\":false,\"outputProperties\":[{\"property\":\"payload\",\"propertyType\":\"msg\",\"value\":\"\",\"valueType\":\"entityState\"}],\"for\":\"0\",\"forType\":\"num\",\"forUnits\":\"minutes\",\"override_topic\":false,\"state_location\":\"payload\",\"override_payload\":\"msg\",\"entity_location\":\"data\",\"override_data\":\"msg\",\"x\":500,\"y\":820,\"wires\":[[\"268fd77321587985\"]]},{\"id\":\"95b372d14c567897\",\"type\":\"switch\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Compare Requested and Actual\",\"property\":\"payload\",\"propertyType\":\"msg\",\"rules\":[{\"t\":\"eq\",\"v\":\"current_temperature\",\"vt\":\"msg\"},{\"t\":\"else\"}],\"checkall\":\"true\",\"repair\":false,\"outputs\":2,\"x\":1330,\"y\":820,\"wires\":[[\"91fea70b06d951e5\"],[\"b838db2d3d9b6ded\"]]},{\"id\":\"681e05a0cfa36406\",\"type\":\"switch\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Check != flow.default_temperature\",\"property\":\"payload\",\"propertyType\":\"msg\",\"rules\":[{\"t\":\"eq\",\"v\":\"default_temperature\",\"vt\":\"flow\"},{\"t\":\"else\"}],\"checkall\":\"true\",\"repair\":false,\"outputs\":2,\"x\":1020,\"y\":820,\"wires\":[[],[\"95b372d14c567897\"]]},{\"id\":\"b838db2d3d9b6ded\",\"type\":\"delay\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Wait 5 Seconds and Recheck\",\"pauseType\":\"delay\",\"timeout\":\"5\",\"timeoutUnits\":\"seconds\",\"rate\":\"1\",\"nbRateUnits\":\"1\",\"rateUnits\":\"second\",\"randomFirst\":\"1\",\"randomLast\":\"5\",\"randomUnits\":\"seconds\",\"drop\":false,\"allowrate\":false,\"outputs\":1,\"x\":720,\"y\":940,\"wires\":[[\"d179e77ab80c9fe8\"]]},{\"id\":\"8078e213ff20ebe9\",\"type\":\"api-call-service\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Reset to Default Temperature\",\"server\":\"f1028730287dd073\",\"version\":5,\"debugenabled\":false,\"domain\":\"number\",\"service\":\"set_value\",\"areaId\":[],\"deviceId\":[],\"entityId\":[\"number.hot_water_temperature\"],\"data\":\"{ \\\"value\\\": default_temperature }\",\"dataType\":\"jsonata\",\"mergeContext\":\"\",\"mustacheAltTags\":false,\"outputProperties\":[],\"queue\":\"none\",\"x\":1960,\"y\":880,\"wires\":[[\"959ae573c614ed1d\"]]},{\"id\":\"5332bd453508c644\",\"type\":\"switch\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Check Temp\",\"property\":\"payload\",\"propertyType\":\"msg\",\"rules\":[{\"t\":\"eq\",\"v\":\"default_temperature\",\"vt\":\"flow\"},{\"t\":\"else\"}],\"checkall\":\"true\",\"repair\":false,\"outputs\":2,\"x\":990,\"y\":980,\"wires\":[[\"e164b7b994e53747\"],[]]},{\"id\":\"e164b7b994e53747\",\"type\":\"change\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Reset Loop\",\"rules\":[{\"t\":\"set\",\"p\":\"reset\",\"pt\":\"msg\",\"to\":\"reset\",\"tot\":\"str\"}],\"action\":\"\",\"property\":\"\",\"from\":\"\",\"to\":\"\",\"reg\":false,\"x\":1170,\"y\":960,\"wires\":[[\"35bc46e08a2a88b3\"]]},{\"id\":\"ac8632db6b12bc0d\",\"type\":\"change\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Enable Set Temp\",\"rules\":[{\"t\":\"set\",\"p\":\"set_temp_enable\",\"pt\":\"flow\",\"to\":\"true\",\"tot\":\"bool\"}],\"action\":\"\",\"property\":\"\",\"from\":\"\",\"to\":\"\",\"reg\":false,\"x\":2090,\"y\":400,\"wires\":[[]]},{\"id\":\"c896f86b6918ce48\",\"type\":\"inject\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Reset\",\"props\":[{\"p\":\"payload\"},{\"p\":\"topic\",\"vt\":\"str\"}],\"repeat\":\"\",\"crontab\":\"\",\"once\":false,\"onceDelay\":0.1,\"topic\":\"\",\"payload\":\"\",\"payloadType\":\"date\",\"x\":1910,\"y\":380,\"wires\":[[\"ac8632db6b12bc0d\"]]},{\"id\":\"c3f6338723a63d68\",\"type\":\"switch\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Only 1 at a time\",\"property\":\"set_temp_enable\",\"propertyType\":\"flow\",\"rules\":[{\"t\":\"false\"},{\"t\":\"else\"}],\"checkall\":\"true\",\"repair\":false,\"outputs\":2,\"x\":1260,\"y\":300,\"wires\":[[],[\"9e45702398f76732\"]],\"info\":\"Setting this bit only allows one change to occur at a time. This can be an issue if the temperature is adjusted multiple times very quickly.\"},{\"id\":\"9e45702398f76732\",\"type\":\"change\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Disable Set Temp\",\"rules\":[{\"t\":\"set\",\"p\":\"set_temp_enable\",\"pt\":\"flow\",\"to\":\"false\",\"tot\":\"bool\"}],\"action\":\"\",\"property\":\"\",\"from\":\"\",\"to\":\"\",\"reg\":false,\"x\":1470,\"y\":300,\"wires\":[[\"eced634799386a54\"]]},{\"id\":\"3559c1ec83840f53\",\"type\":\"inject\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Reset Enable Flag Worker\",\"props\":[{\"p\":\"payload\"}],\"repeat\":\"5\",\"crontab\":\"\",\"once\":true,\"onceDelay\":\"10\",\"topic\":\"\",\"payload\":\"\",\"payloadType\":\"date\",\"x\":220,\"y\":1140,\"wires\":[[\"b99426195443e181\",\"a77eab72b919fa50\"]],\"info\":\"The device is very finicky and even with my hot water heater around 3 metres from the wifi module it drops out every now and then.\\r\\nThis resets the enable flags once per minute in case there is a connectivity issue to deal with this potential issue.\"},{\"id\":\"b99426195443e181\",\"type\":\"switch\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Status Enable Flag\",\"property\":\"get_status_enable\",\"propertyType\":\"flow\",\"rules\":[{\"t\":\"false\"},{\"t\":\"else\"}],\"checkall\":\"true\",\"repair\":false,\"outputs\":2,\"x\":490,\"y\":1120,\"wires\":[[\"177d3d08ba3c7dac\"],[]]},{\"id\":\"a77eab72b919fa50\",\"type\":\"switch\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Temp Enable Flag\",\"property\":\"set_temp_enable\",\"propertyType\":\"flow\",\"rules\":[{\"t\":\"false\"},{\"t\":\"else\"}],\"checkall\":\"true\",\"repair\":false,\"outputs\":2,\"x\":490,\"y\":1180,\"wires\":[[\"e453f5396d7ade80\"],[]]},{\"id\":\"177d3d08ba3c7dac\",\"type\":\"delay\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Rate Limit to 1 per Minute\",\"pauseType\":\"rate\",\"timeout\":\"5\",\"timeoutUnits\":\"seconds\",\"rate\":\"1\",\"nbRateUnits\":\"1\",\"rateUnits\":\"minute\",\"randomFirst\":\"1\",\"randomLast\":\"5\",\"randomUnits\":\"seconds\",\"drop\":true,\"allowrate\":false,\"outputs\":1,\"x\":730,\"y\":1120,\"wires\":[[\"923ef1f2ef005460\"]]},{\"id\":\"e453f5396d7ade80\",\"type\":\"delay\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Rate Limit to 1 per Minute\",\"pauseType\":\"rate\",\"timeout\":\"5\",\"timeoutUnits\":\"seconds\",\"rate\":\"1\",\"nbRateUnits\":\"1\",\"rateUnits\":\"minute\",\"randomFirst\":\"1\",\"randomLast\":\"5\",\"randomUnits\":\"seconds\",\"drop\":true,\"allowrate\":false,\"outputs\":1,\"x\":730,\"y\":1180,\"wires\":[[\"2edd37d95f8da095\"]]},{\"id\":\"923ef1f2ef005460\",\"type\":\"delay\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Wait 1 minute\",\"pauseType\":\"delay\",\"timeout\":\"1\",\"timeoutUnits\":\"minutes\",\"rate\":\"1\",\"nbRateUnits\":\"1\",\"rateUnits\":\"second\",\"randomFirst\":\"1\",\"randomLast\":\"5\",\"randomUnits\":\"seconds\",\"drop\":false,\"allowrate\":false,\"outputs\":1,\"x\":1000,\"y\":1120,\"wires\":[[\"2d2af9e970c7c24a\"]]},{\"id\":\"2edd37d95f8da095\",\"type\":\"delay\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Wait 1 minute\",\"pauseType\":\"delay\",\"timeout\":\"1\",\"timeoutUnits\":\"minutes\",\"rate\":\"1\",\"nbRateUnits\":\"1\",\"rateUnits\":\"second\",\"randomFirst\":\"1\",\"randomLast\":\"5\",\"randomUnits\":\"seconds\",\"drop\":false,\"allowrate\":false,\"outputs\":1,\"x\":1000,\"y\":1180,\"wires\":[[\"eae7323633b22869\"]]},{\"id\":\"2d2af9e970c7c24a\",\"type\":\"change\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Enable Status check\",\"rules\":[{\"t\":\"set\",\"p\":\"get_status_enable\",\"pt\":\"flow\",\"to\":\"true\",\"tot\":\"bool\"}],\"action\":\"\",\"property\":\"\",\"from\":\"\",\"to\":\"\",\"reg\":false,\"x\":1220,\"y\":1120,\"wires\":[[\"72a9ccfb8a182444\"]]},{\"id\":\"eae7323633b22869\",\"type\":\"change\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Enable Set Temp\",\"rules\":[{\"t\":\"set\",\"p\":\"set_temp_enable\",\"pt\":\"flow\",\"to\":\"true\",\"tot\":\"bool\"}],\"action\":\"\",\"property\":\"\",\"from\":\"\",\"to\":\"\",\"reg\":false,\"x\":1210,\"y\":1180,\"wires\":[[\"d0f52e80b4f985e0\"]]},{\"id\":\"72a9ccfb8a182444\",\"type\":\"change\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Reset\",\"rules\":[{\"t\":\"set\",\"p\":\"reset\",\"pt\":\"msg\",\"to\":\"true\",\"tot\":\"bool\"}],\"action\":\"\",\"property\":\"\",\"from\":\"\",\"to\":\"\",\"reg\":false,\"x\":1430,\"y\":1120,\"wires\":[[\"923ef1f2ef005460\",\"177d3d08ba3c7dac\"]]},{\"id\":\"d0f52e80b4f985e0\",\"type\":\"change\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Reset\",\"rules\":[{\"t\":\"set\",\"p\":\"reset\",\"pt\":\"msg\",\"to\":\"true\",\"tot\":\"bool\"}],\"action\":\"\",\"property\":\"\",\"from\":\"\",\"to\":\"\",\"reg\":false,\"x\":1430,\"y\":1180,\"wires\":[[\"2edd37d95f8da095\",\"e453f5396d7ade80\"]]},{\"id\":\"e9d184371b445d91\",\"type\":\"delay\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Maximum 1 per 1 second(s)\",\"pauseType\":\"rate\",\"timeout\":\"5\",\"timeoutUnits\":\"seconds\",\"rate\":\"1\",\"nbRateUnits\":\"1\",\"rateUnits\":\"second\",\"randomFirst\":\"1\",\"randomLast\":\"5\",\"randomUnits\":\"seconds\",\"drop\":true,\"allowrate\":true,\"outputs\":1,\"x\":470,\"y\":100,\"wires\":[[\"5b42f717a84ae8e1\"]]},{\"id\":\"2396d678c51f07e1\",\"type\":\"switch\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Check Status Code\",\"property\":\"statusCode\",\"propertyType\":\"msg\",\"rules\":[{\"t\":\"eq\",\"v\":\"200\",\"vt\":\"num\"},{\"t\":\"else\"}],\"checkall\":\"true\",\"repair\":false,\"outputs\":2,\"x\":890,\"y\":100,\"wires\":[[\"384128d5d75a8c8e\",\"193d8d9d89153d32\",\"30fb9c2a26d1c6bc\"],[\"21057ddd5151fd0a\"]]},{\"id\":\"21057ddd5151fd0a\",\"type\":\"change\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Change Rate Limit to 1/5min\",\"rules\":[{\"t\":\"delete\",\"p\":\"payload\",\"pt\":\"msg\"},{\"t\":\"set\",\"p\":\"rate\",\"pt\":\"msg\",\"to\":\"300000\",\"tot\":\"num\"},{\"t\":\"set\",\"p\":\"payload.state\",\"pt\":\"msg\",\"to\":\"true\",\"tot\":\"bool\"}],\"action\":\"\",\"property\":\"\",\"from\":\"\",\"to\":\"\",\"reg\":false,\"x\":1060,\"y\":180,\"wires\":[[\"e9d184371b445d91\",\"a7839f383614bfc2\"]],\"info\":\"Lower the rate limit if the device appears to be offline. There can be issues with requests queuing up and then bombarding the device all at once.\"},{\"id\":\"384128d5d75a8c8e\",\"type\":\"change\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Change Rate Limit to 1/1s\",\"rules\":[{\"t\":\"delete\",\"p\":\"payload\",\"pt\":\"msg\"},{\"t\":\"set\",\"p\":\"rate\",\"pt\":\"msg\",\"to\":\"1000\",\"tot\":\"num\"},{\"t\":\"set\",\"p\":\"payload.state\",\"pt\":\"msg\",\"to\":\"false\",\"tot\":\"bool\"}],\"action\":\"\",\"property\":\"\",\"from\":\"\",\"to\":\"\",\"reg\":false,\"x\":1130,\"y\":40,\"wires\":[[\"e9d184371b445d91\",\"a7839f383614bfc2\"]],\"info\":\"The rate limit is set to 1s because the device is naive and will block all requests if too many requests are sent per second (this can happen if for example if the status worker queues a request every second but the request takes more than 1 second to complete (resulting in multiple requests hitting the device at a time)).\"},{\"id\":\"a7839f383614bfc2\",\"type\":\"ha-binary-sensor\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Hot Water System Fault\",\"entityConfig\":\"1f0b4dda838ff26f\",\"version\":0,\"state\":\"payload\",\"stateType\":\"msg\",\"attributes\":[],\"inputOverride\":\"allow\",\"outputProperties\":[],\"x\":1650,\"y\":180,\"wires\":[[]]},{\"id\":\"24961fb23aa2b21f\",\"type\":\"server-state-changed\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Automation - Hot Water Timeout\",\"server\":\"f1028730287dd073\",\"version\":5,\"outputs\":1,\"exposeAsEntityConfig\":\"020edd2b2bd16f44\",\"entityId\":\"number.hot_water_temperature\",\"entityIdType\":\"exact\",\"outputInitially\":false,\"stateType\":\"str\",\"ifState\":\"\",\"ifStateType\":\"str\",\"ifStateOperator\":\"is\",\"outputOnlyOnStateChange\":true,\"for\":\"0\",\"forType\":\"num\",\"forUnits\":\"minutes\",\"ignorePrevStateNull\":false,\"ignorePrevStateUnknown\":false,\"ignorePrevStateUnavailable\":false,\"ignoreCurrentStateUnknown\":false,\"ignoreCurrentStateUnavailable\":false,\"outputProperties\":[{\"property\":\"payload\",\"propertyType\":\"msg\",\"value\":\"\",\"valueType\":\"entityState\"},{\"property\":\"data\",\"propertyType\":\"msg\",\"value\":\"\",\"valueType\":\"eventData\"},{\"property\":\"topic\",\"propertyType\":\"msg\",\"value\":\"\",\"valueType\":\"triggerId\"}],\"x\":230,\"y\":820,\"wires\":[[\"d179e77ab80c9fe8\",\"959ae573c614ed1d\"]]},{\"id\":\"51cf436bbd7cbaf4\",\"type\":\"ha-number\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Hot Water Temperature\",\"version\":1,\"debugenabled\":false,\"inputs\":0,\"outputs\":1,\"entityConfig\":\"45814c1df11da288\",\"mode\":\"listen\",\"value\":\"payload\",\"valueType\":\"msg\",\"outputProperties\":[{\"property\":\"payload\",\"propertyType\":\"msg\",\"value\":\"\",\"valueType\":\"value\"}],\"x\":200,\"y\":300,\"wires\":[[\"c49192547f6f2c1c\"]]},{\"id\":\"e05abb2bfb924b50\",\"type\":\"ha-sensor\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Hot Water Current Temperature\",\"entityConfig\":\"8f5d41d1249b7816\",\"version\":0,\"state\":\"payload.temp\",\"stateType\":\"msg\",\"attributes\":[],\"inputOverride\":\"allow\",\"outputProperties\":[],\"x\":1650,\"y\":100,\"wires\":[[]]},{\"id\":\"508645f10065beeb\",\"type\":\"ha-sensor\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Hot Water Flow\",\"entityConfig\":\"1ce788ad9baaf0e1\",\"version\":0,\"state\":\"payload.flow\",\"stateType\":\"msg\",\"attributes\":[],\"inputOverride\":\"block\",\"outputProperties\":[],\"x\":1580,\"y\":40,\"wires\":[[]]},{\"id\":\"193d8d9d89153d32\",\"type\":\"change\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Rewrite Msg\",\"rules\":[{\"t\":\"set\",\"p\":\"payload.state\",\"pt\":\"msg\",\"to\":\"payload.flow\",\"tot\":\"msg\"}],\"action\":\"\",\"property\":\"\",\"from\":\"\",\"to\":\"\",\"reg\":false,\"x\":1290,\"y\":80,\"wires\":[[\"508645f10065beeb\"]]},{\"id\":\"30fb9c2a26d1c6bc\",\"type\":\"change\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Rewrite Msg\",\"rules\":[{\"t\":\"set\",\"p\":\"payload.state\",\"pt\":\"msg\",\"to\":\"payload.temp\",\"tot\":\"msg\"}],\"action\":\"\",\"property\":\"\",\"from\":\"\",\"to\":\"\",\"reg\":false,\"x\":1290,\"y\":140,\"wires\":[[\"e05abb2bfb924b50\"]]},{\"id\":\"bac57b6064eedf90\",\"type\":\"switch\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Compare Requested and Current\",\"property\":\"payload\",\"propertyType\":\"msg\",\"rules\":[{\"t\":\"eq\",\"v\":\"current_temperature\",\"vt\":\"msg\"},{\"t\":\"else\"}],\"checkall\":\"true\",\"repair\":false,\"outputs\":2,\"x\":740,\"y\":300,\"wires\":[[],[\"ab64e497209d9b70\"]]},{\"id\":\"c49192547f6f2c1c\",\"type\":\"api-current-state\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Check Current Temperature\",\"server\":\"f1028730287dd073\",\"version\":3,\"outputs\":1,\"halt_if\":\"\",\"halt_if_type\":\"str\",\"halt_if_compare\":\"is\",\"entity_id\":\"sensor.hot_water_current_temperature\",\"state_type\":\"str\",\"blockInputOverrides\":false,\"outputProperties\":[{\"property\":\"current_temperature\",\"propertyType\":\"msg\",\"value\":\"\",\"valueType\":\"entityState\"}],\"for\":\"0\",\"forType\":\"num\",\"forUnits\":\"minutes\",\"override_topic\":false,\"state_location\":\"payload\",\"override_payload\":\"msg\",\"entity_location\":\"data\",\"override_data\":\"msg\",\"x\":460,\"y\":300,\"wires\":[[\"bac57b6064eedf90\"]]},{\"id\":\"3462a5e5c5120024\",\"type\":\"ha-number\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Hot Water Default Temperature\",\"version\":1,\"debugenabled\":false,\"inputs\":0,\"outputs\":1,\"entityConfig\":\"8660e8bc5b0a715e\",\"mode\":\"listen\",\"value\":\"payload\",\"valueType\":\"msg\",\"outputProperties\":[{\"property\":\"payload\",\"propertyType\":\"msg\",\"value\":\"\",\"valueType\":\"value\"},{\"property\":\"previousValue\",\"propertyType\":\"msg\",\"value\":\"\",\"valueType\":\"previousValue\"}],\"x\":210,\"y\":600,\"wires\":[[\"fb4de64eada90c7f\"]]},{\"id\":\"fb4de64eada90c7f\",\"type\":\"change\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Set flow.default_temperature\",\"rules\":[{\"t\":\"set\",\"p\":\"default_temperature\",\"pt\":\"flow\",\"to\":\"payload\",\"tot\":\"msg\"}],\"action\":\"\",\"property\":\"\",\"from\":\"\",\"to\":\"\",\"reg\":false,\"x\":660,\"y\":600,\"wires\":[[\"c95a99d6cb4e8061\"]]},{\"id\":\"ca16e3a8acc1e20b\",\"type\":\"server-state-changed\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Check if Temp Manually Changed\",\"server\":\"f1028730287dd073\",\"version\":5,\"outputs\":1,\"exposeAsEntityConfig\":\"\",\"entityId\":\"sensor.hot_water_current_temperature\",\"entityIdType\":\"exact\",\"outputInitially\":false,\"stateType\":\"str\",\"ifState\":\"\",\"ifStateType\":\"str\",\"ifStateOperator\":\"is\",\"outputOnlyOnStateChange\":true,\"for\":\"0\",\"forType\":\"num\",\"forUnits\":\"minutes\",\"ignorePrevStateNull\":false,\"ignorePrevStateUnknown\":false,\"ignorePrevStateUnavailable\":false,\"ignoreCurrentStateUnknown\":false,\"ignoreCurrentStateUnavailable\":false,\"outputProperties\":[{\"property\":\"payload\",\"propertyType\":\"msg\",\"value\":\"\",\"valueType\":\"entityState\"},{\"property\":\"data\",\"propertyType\":\"msg\",\"value\":\"\",\"valueType\":\"eventData\"},{\"property\":\"topic\",\"propertyType\":\"msg\",\"value\":\"\",\"valueType\":\"triggerId\"}],\"x\":710,\"y\":1020,\"wires\":[[\"5332bd453508c644\"]]},{\"id\":\"268fd77321587985\",\"type\":\"api-current-state\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Get Current Temperature\",\"server\":\"f1028730287dd073\",\"version\":3,\"outputs\":1,\"halt_if\":\"\",\"halt_if_type\":\"str\",\"halt_if_compare\":\"is\",\"entity_id\":\"sensor.hot_water_current_temperature\",\"state_type\":\"str\",\"blockInputOverrides\":false,\"outputProperties\":[{\"property\":\"current_temperature\",\"propertyType\":\"msg\",\"value\":\"\",\"valueType\":\"entityState\"}],\"for\":\"0\",\"forType\":\"num\",\"forUnits\":\"minutes\",\"override_topic\":false,\"state_location\":\"payload\",\"override_payload\":\"msg\",\"entity_location\":\"data\",\"override_data\":\"msg\",\"x\":750,\"y\":820,\"wires\":[[\"681e05a0cfa36406\"]],\"info\":\"This makes the loop wait until the requested temp = current temp (otherwise the temperature change worker is likely still operating)\"},{\"id\":\"b59baed7a9f31063\",\"type\":\"ha-number\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Hot Water Timeout\",\"version\":1,\"debugenabled\":false,\"inputs\":0,\"outputs\":1,\"entityConfig\":\"8d8d8a2ce2269de0\",\"mode\":\"listen\",\"value\":\"payload\",\"valueType\":\"msg\",\"outputProperties\":[{\"property\":\"payload\",\"propertyType\":\"msg\",\"value\":\"\",\"valueType\":\"value\"}],\"x\":170,\"y\":680,\"wires\":[[\"76b7c7aa0a8ad2de\"]]},{\"id\":\"76b7c7aa0a8ad2de\",\"type\":\"function\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Convert to milliseconds\",\"func\":\"msg.payload = msg.payload * 60 * 1000;\\nreturn msg;\",\"outputs\":1,\"timeout\":\"\",\"noerr\":0,\"initialize\":\"\",\"finalize\":\"\",\"libs\":[],\"x\":690,\"y\":680,\"wires\":[[\"04e4f3819fda56d7\"]]},{\"id\":\"04e4f3819fda56d7\",\"type\":\"change\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Set flow.delay\",\"rules\":[{\"t\":\"set\",\"p\":\"delay\",\"pt\":\"flow\",\"to\":\"payload\",\"tot\":\"msg\"}],\"action\":\"\",\"property\":\"\",\"from\":\"\",\"to\":\"\",\"reg\":false,\"x\":920,\"y\":680,\"wires\":[[]]},{\"id\":\"91fea70b06d951e5\",\"type\":\"change\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Set Delay and Default Temperature\",\"rules\":[{\"t\":\"set\",\"p\":\"delay\",\"pt\":\"msg\",\"to\":\"delay\",\"tot\":\"flow\"},{\"t\":\"set\",\"p\":\"default_temperature\",\"pt\":\"msg\",\"to\":\"default_temperature\",\"tot\":\"flow\"}],\"action\":\"\",\"property\":\"\",\"from\":\"\",\"to\":\"\",\"reg\":false,\"x\":1660,\"y\":820,\"wires\":[[\"35bc46e08a2a88b3\"]]},{\"id\":\"c95a99d6cb4e8061\",\"type\":\"api-call-service\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Set Temperature to Default\",\"server\":\"f1028730287dd073\",\"version\":5,\"debugenabled\":false,\"domain\":\"number\",\"service\":\"set_value\",\"areaId\":[],\"deviceId\":[],\"entityId\":[\"number.hot_water_temperature\"],\"data\":\"{ \\\"value\\\": payload }\",\"dataType\":\"jsonata\",\"mergeContext\":\"\",\"mustacheAltTags\":false,\"outputProperties\":[],\"queue\":\"none\",\"x\":940,\"y\":600,\"wires\":[[]]},{\"id\":\"2cdefe2e3a3c1b76\",\"type\":\"inject\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Run Once on Startup\",\"props\":[{\"p\":\"payload\"}],\"repeat\":\"\",\"crontab\":\"\",\"once\":true,\"onceDelay\":\"10\",\"topic\":\"\",\"payload\":\"\",\"payloadType\":\"date\",\"x\":200,\"y\":740,\"wires\":[[\"6a835e9ed6f964c6\"]]},{\"id\":\"6a835e9ed6f964c6\",\"type\":\"api-current-state\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Get Hot Water Timeout\",\"server\":\"f1028730287dd073\",\"version\":3,\"outputs\":1,\"halt_if\":\"\",\"halt_if_type\":\"str\",\"halt_if_compare\":\"is\",\"entity_id\":\"number.hot_water_timeout\",\"state_type\":\"str\",\"blockInputOverrides\":false,\"outputProperties\":[{\"property\":\"payload\",\"propertyType\":\"msg\",\"value\":\"\",\"valueType\":\"entityState\"}],\"for\":\"0\",\"forType\":\"num\",\"forUnits\":\"minutes\",\"override_topic\":false,\"state_location\":\"payload\",\"override_payload\":\"msg\",\"entity_location\":\"data\",\"override_data\":\"msg\",\"x\":420,\"y\":740,\"wires\":[[\"76b7c7aa0a8ad2de\"]]},{\"id\":\"6f5879b3c824d8c1\",\"type\":\"inject\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Run Once on Startup\",\"props\":[{\"p\":\"payload\"}],\"repeat\":\"\",\"crontab\":\"\",\"once\":true,\"onceDelay\":\"10\",\"topic\":\"\",\"payload\":\"\",\"payloadType\":\"date\",\"x\":180,\"y\":540,\"wires\":[[\"1ad6d0113da91aee\"]]},{\"id\":\"1ad6d0113da91aee\",\"type\":\"api-current-state\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Get Hot Water Timeout\",\"server\":\"f1028730287dd073\",\"version\":3,\"outputs\":1,\"halt_if\":\"\",\"halt_if_type\":\"str\",\"halt_if_compare\":\"is\",\"entity_id\":\"number.hot_water_default_temperature\",\"state_type\":\"str\",\"blockInputOverrides\":false,\"outputProperties\":[{\"property\":\"payload\",\"propertyType\":\"msg\",\"value\":\"\",\"valueType\":\"entityState\"}],\"for\":\"0\",\"forType\":\"num\",\"forUnits\":\"minutes\",\"override_topic\":false,\"state_location\":\"payload\",\"override_payload\":\"msg\",\"entity_location\":\"data\",\"override_data\":\"msg\",\"x\":400,\"y\":540,\"wires\":[[\"fb4de64eada90c7f\"]]},{\"id\":\"f1028730287dd073\",\"type\":\"server\",\"name\":\"Home Assistant\",\"version\":5,\"addon\":true,\"rejectUnauthorizedCerts\":true,\"ha_boolean\":\"y|yes|true|on|home|open\",\"connectionDelay\":true,\"cacheJson\":true,\"heartbeat\":false,\"heartbeatInterval\":\"30\",\"areaSelector\":\"friendlyName\",\"deviceSelector\":\"friendlyName\",\"entitySelector\":\"friendlyName\",\"statusSeparator\":\"at: \",\"statusYear\":\"hidden\",\"statusMonth\":\"short\",\"statusDay\":\"numeric\",\"statusHourCycle\":\"h23\",\"statusTimeFormat\":\"h:m\",\"enableGlobalContextStore\":true},{\"id\":\"1f0b4dda838ff26f\",\"type\":\"ha-entity-config\",\"server\":\"f1028730287dd073\",\"deviceConfig\":\"ac4d05f67b79f774\",\"name\":\"Binary Sensor for Hot Water System Fault\",\"version\":\"6\",\"entityType\":\"binary_sensor\",\"haConfig\":[{\"property\":\"name\",\"value\":\"Hot Water System Fault\"},{\"property\":\"icon\",\"value\":\"\"},{\"property\":\"entity_category\",\"value\":\"diagnostic\"},{\"property\":\"entity_picture\",\"value\":\"\"},{\"property\":\"device_class\",\"value\":\"problem\"}],\"resend\":false,\"debugEnabled\":false},{\"id\":\"020edd2b2bd16f44\",\"type\":\"ha-entity-config\",\"server\":\"f1028730287dd073\",\"deviceConfig\":\"ac4d05f67b79f774\",\"name\":\"exposed as for Automation - Hot Water Timeout\",\"version\":\"6\",\"entityType\":\"switch\",\"haConfig\":[{\"property\":\"name\",\"value\":\"Automation - Hot Water Timeout\"},{\"property\":\"icon\",\"value\":\"mdi:timer-cancel\"},{\"property\":\"entity_category\",\"value\":\"config\"},{\"property\":\"entity_picture\",\"value\":\"\"},{\"property\":\"device_class\",\"value\":\"\"}],\"resend\":false,\"debugEnabled\":false},{\"id\":\"45814c1df11da288\",\"type\":\"ha-entity-config\",\"server\":\"f1028730287dd073\",\"deviceConfig\":\"ac4d05f67b79f774\",\"name\":\"Number for Hot Water Temperature\",\"version\":\"6\",\"entityType\":\"number\",\"haConfig\":[{\"property\":\"name\",\"value\":\"Hot Water Temperature\"},{\"property\":\"icon\",\"value\":\"mdi:kettle-steam-outline\"},{\"property\":\"entity_category\",\"value\":\"\"},{\"property\":\"entity_picture\",\"value\":\"\"},{\"property\":\"device_class\",\"value\":\"temperature\"},{\"property\":\"unit_of_measurement\",\"value\":\"\u00b0C\"},{\"property\":\"min_value\",\"value\":37},{\"property\":\"max_value\",\"value\":50},{\"property\":\"step_value\",\"value\":1},{\"property\":\"mode\",\"value\":\"auto\"}],\"resend\":false,\"debugEnabled\":false},{\"id\":\"8f5d41d1249b7816\",\"type\":\"ha-entity-config\",\"server\":\"f1028730287dd073\",\"deviceConfig\":\"ac4d05f67b79f774\",\"name\":\"Sensor Config for Hot Water Current Temperature\",\"version\":\"6\",\"entityType\":\"sensor\",\"haConfig\":[{\"property\":\"name\",\"value\":\"Hot Water Current Temperature\"},{\"property\":\"icon\",\"value\":\"\"},{\"property\":\"entity_category\",\"value\":\"\"},{\"property\":\"entity_picture\",\"value\":\"\"},{\"property\":\"device_class\",\"value\":\"temperature\"},{\"property\":\"unit_of_measurement\",\"value\":\"\u00b0C\"},{\"property\":\"state_class\",\"value\":\"measurement\"}],\"resend\":false,\"debugEnabled\":false},{\"id\":\"1ce788ad9baaf0e1\",\"type\":\"ha-entity-config\",\"server\":\"f1028730287dd073\",\"deviceConfig\":\"ac4d05f67b79f774\",\"name\":\"Sensor Config for Hot Water Flow\",\"version\":\"6\",\"entityType\":\"sensor\",\"haConfig\":[{\"property\":\"name\",\"value\":\"Hot Water Flow\"},{\"property\":\"icon\",\"value\":\"mdi:faucet\"},{\"property\":\"entity_category\",\"value\":\"\"},{\"property\":\"entity_picture\",\"value\":\"\"},{\"property\":\"device_class\",\"value\":\"\"},{\"property\":\"unit_of_measurement\",\"value\":\"L/min\"},{\"property\":\"state_class\",\"value\":\"measurement\"}],\"resend\":false,\"debugEnabled\":false},{\"id\":\"8660e8bc5b0a715e\",\"type\":\"ha-entity-config\",\"server\":\"f1028730287dd073\",\"deviceConfig\":\"ac4d05f67b79f774\",\"name\":\"Number Config for Hot Water Default Temperature\",\"version\":\"6\",\"entityType\":\"number\",\"haConfig\":[{\"property\":\"name\",\"value\":\"Hot Water Default Temperature\"},{\"property\":\"icon\",\"value\":\"mdi:thermometer\"},{\"property\":\"entity_category\",\"value\":\"config\"},{\"property\":\"entity_picture\",\"value\":\"\"},{\"property\":\"device_class\",\"value\":\"temperature\"},{\"property\":\"unit_of_measurement\",\"value\":\"\u00b0C\"},{\"property\":\"min_value\",\"value\":37},{\"property\":\"max_value\",\"value\":50},{\"property\":\"step_value\",\"value\":1},{\"property\":\"mode\",\"value\":\"auto\"}],\"resend\":false,\"debugEnabled\":false},{\"id\":\"8d8d8a2ce2269de0\",\"type\":\"ha-entity-config\",\"server\":\"f1028730287dd073\",\"deviceConfig\":\"ac4d05f67b79f774\",\"name\":\"Number for Hot Water Timeout\",\"version\":\"6\",\"entityType\":\"number\",\"haConfig\":[{\"property\":\"name\",\"value\":\"Hot Water Timeout\"},{\"property\":\"icon\",\"value\":\"mdi:timer\"},{\"property\":\"entity_category\",\"value\":\"config\"},{\"property\":\"entity_picture\",\"value\":\"\"},{\"property\":\"device_class\",\"value\":\"\"},{\"property\":\"unit_of_measurement\",\"value\":\"min\"},{\"property\":\"min_value\",\"value\":0},{\"property\":\"max_value\",\"value\":60},{\"property\":\"step_value\",\"value\":1},{\"property\":\"mode\",\"value\":\"box\"}],\"resend\":false,\"debugEnabled\":false},{\"id\":\"ac4d05f67b79f774\",\"type\":\"ha-device-config\",\"name\":\"Rheem Hot Water System\",\"hwVersion\":\"\",\"manufacturer\":\"Rheem\",\"model\":\"\",\"swVersion\":\"\"}]\n</code></pre>"},{"location":"ha/#node-red-flow-optional-google-home-siri-components_1","title":"Node-Red Flow (Optional Google Home/ Siri Components)","text":"<p>Import this onto the same flow as the above.</p> Node-Red Flow (Optional Google Home/ Siri Components)<pre><code>[{\"id\":\"65619639265cf5ea\",\"type\":\"api-call-service\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Set Water Hot\",\"server\":\"f1028730287dd073\",\"version\":5,\"debugenabled\":false,\"domain\":\"number\",\"service\":\"set_value\",\"areaId\":[],\"deviceId\":[],\"entityId\":[\"number.hot_water_temperature\"],\"data\":\"{\\\"value\\\":\\\"50\\\"}\",\"dataType\":\"json\",\"mergeContext\":\"\",\"mustacheAltTags\":false,\"outputProperties\":[],\"queue\":\"none\",\"x\":520,\"y\":1500,\"wires\":[[]]},{\"id\":\"741797cf63baafe2\",\"type\":\"api-call-service\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Set Water Normal\",\"server\":\"f1028730287dd073\",\"version\":5,\"debugenabled\":false,\"domain\":\"number\",\"service\":\"set_value\",\"areaId\":[],\"deviceId\":[],\"entityId\":[\"number.hot_water_temperature\"],\"data\":\"{ \\\"value\\\" : payload }\",\"dataType\":\"jsonata\",\"mergeContext\":\"\",\"mustacheAltTags\":false,\"outputProperties\":[],\"queue\":\"none\",\"x\":890,\"y\":1560,\"wires\":[[]]},{\"id\":\"02ded775b14645ca\",\"type\":\"switch\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Check Temp\",\"property\":\"payload\",\"propertyType\":\"msg\",\"rules\":[{\"t\":\"eq\",\"v\":\"default_temperature\",\"vt\":\"flow\"},{\"t\":\"else\"}],\"checkall\":\"true\",\"repair\":false,\"outputs\":2,\"x\":650,\"y\":1640,\"wires\":[[\"4e7cfaf142737137\"],[]]},{\"id\":\"2aa646efaaf4bad9\",\"type\":\"inject\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Hot Water Switch Update Worker\",\"props\":[{\"p\":\"payload\"}],\"repeat\":\"5\",\"crontab\":\"\",\"once\":true,\"onceDelay\":0.1,\"topic\":\"\",\"payload\":\"\",\"payloadType\":\"date\",\"x\":280,\"y\":1640,\"wires\":[[\"cc50e38cf7f45292\"]]},{\"id\":\"cc50e38cf7f45292\",\"type\":\"api-current-state\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Get State\",\"server\":\"f1028730287dd073\",\"version\":3,\"outputs\":1,\"halt_if\":\"\",\"halt_if_type\":\"str\",\"halt_if_compare\":\"is\",\"entity_id\":\"number.hot_water_temperature\",\"state_type\":\"str\",\"blockInputOverrides\":false,\"outputProperties\":[{\"property\":\"payload\",\"propertyType\":\"msg\",\"value\":\"\",\"valueType\":\"entityState\"}],\"for\":\"0\",\"forType\":\"num\",\"forUnits\":\"minutes\",\"override_topic\":false,\"state_location\":\"payload\",\"override_payload\":\"msg\",\"entity_location\":\"data\",\"override_data\":\"msg\",\"x\":500,\"y\":1640,\"wires\":[[\"02ded775b14645ca\"]]},{\"id\":\"4e7cfaf142737137\",\"type\":\"api-current-state\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Get Switch State\",\"server\":\"f1028730287dd073\",\"version\":3,\"outputs\":2,\"halt_if\":\"on\",\"halt_if_type\":\"str\",\"halt_if_compare\":\"is\",\"entity_id\":\"switch.hot_water\",\"state_type\":\"str\",\"blockInputOverrides\":false,\"outputProperties\":[{\"property\":\"payload\",\"propertyType\":\"msg\",\"value\":\"\",\"valueType\":\"entityState\"}],\"for\":\"0\",\"forType\":\"num\",\"forUnits\":\"minutes\",\"override_topic\":false,\"state_location\":\"payload\",\"override_payload\":\"msg\",\"entity_location\":\"data\",\"override_data\":\"msg\",\"x\":850,\"y\":1640,\"wires\":[[\"8103ab9894b106a7\"],[]]},{\"id\":\"8103ab9894b106a7\",\"type\":\"api-call-service\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Turn off Switch\",\"server\":\"f1028730287dd073\",\"version\":5,\"debugenabled\":false,\"domain\":\"switch\",\"service\":\"turn_off\",\"areaId\":[],\"deviceId\":[],\"entityId\":[\"switch.hot_water\"],\"data\":\"\",\"dataType\":\"jsonata\",\"mergeContext\":\"\",\"mustacheAltTags\":false,\"outputProperties\":[],\"queue\":\"none\",\"x\":1060,\"y\":1640,\"wires\":[[]]},{\"id\":\"1d92721dc5c2d73e\",\"type\":\"ha-switch\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Hot Water Switch - Google Helper\",\"version\":0,\"inputs\":1,\"outputs\":2,\"entityConfig\":\"5ac0a59db72278da\",\"enableInput\":true,\"outputOnStateChange\":true,\"outputProperties\":[{\"property\":\"payload\",\"propertyType\":\"msg\",\"value\":\"$entity().state ? \\\"on\\\": \\\"off\\\"\",\"valueType\":\"jsonata\"}],\"x\":240,\"y\":1520,\"wires\":[[\"65619639265cf5ea\"],[\"b58efdd7978d22ca\"]],\"info\":\"Google Home/ Assistant doesn't currently allow number inputs. This allows switching between two hot and normal using Google devices.\"},{\"id\":\"b58efdd7978d22ca\",\"type\":\"change\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Set payload to flow.default_temperature\",\"rules\":[{\"t\":\"set\",\"p\":\"payload\",\"pt\":\"msg\",\"to\":\"default_temperature\",\"tot\":\"flow\"}],\"action\":\"\",\"property\":\"\",\"from\":\"\",\"to\":\"\",\"reg\":false,\"x\":600,\"y\":1560,\"wires\":[[\"741797cf63baafe2\"]]},{\"id\":\"f1028730287dd073\",\"type\":\"server\",\"name\":\"Home Assistant\",\"version\":5,\"addon\":true,\"rejectUnauthorizedCerts\":true,\"ha_boolean\":\"y|yes|true|on|home|open\",\"connectionDelay\":true,\"cacheJson\":true,\"heartbeat\":false,\"heartbeatInterval\":\"30\",\"areaSelector\":\"friendlyName\",\"deviceSelector\":\"friendlyName\",\"entitySelector\":\"friendlyName\",\"statusSeparator\":\"at: \",\"statusYear\":\"hidden\",\"statusMonth\":\"short\",\"statusDay\":\"numeric\",\"statusHourCycle\":\"h23\",\"statusTimeFormat\":\"h:m\",\"enableGlobalContextStore\":true},{\"id\":\"5ac0a59db72278da\",\"type\":\"ha-entity-config\",\"server\":\"f1028730287dd073\",\"deviceConfig\":\"ac4d05f67b79f774\",\"name\":\"switch config for Hot Water Switch - Google Helper\",\"version\":\"6\",\"entityType\":\"switch\",\"haConfig\":[{\"property\":\"name\",\"value\":\"Hot Water\"},{\"property\":\"icon\",\"value\":\"mdi:kettle-steam-outline\"},{\"property\":\"entity_category\",\"value\":\"\"},{\"property\":\"entity_picture\",\"value\":\"\"},{\"property\":\"device_class\",\"value\":\"\"}],\"resend\":true,\"debugEnabled\":false},{\"id\":\"ac4d05f67b79f774\",\"type\":\"ha-device-config\",\"name\":\"Rheem Hot Water System\",\"hwVersion\":\"\",\"manufacturer\":\"Rheem\",\"model\":\"\",\"swVersion\":\"\"}]\n</code></pre> <ol> <li> <p>Australian Building Codes Board, Handbook: Warm water systems, page 4: https://www.abcb.gov.au/sites/default/files/resources/2022/Handbook-warm-water-systems.pdf\u00a0\u21a9</p> </li> </ol>"},{"location":"ha_old/","title":"Home Assistant","text":"<p>This is my old implementation. I have discontinued its use because it relies on the user creating the relevant <code>input_number</code>.</p> <p>It was also far more complicated than necessary due to the interplay between HA and Node-RED and probably also some shoddy logic on my part.</p>"},{"location":"ha_old/#working-theory","title":"Working Theory","text":"<p>The below code creates 3 HA entities:</p> <ul> <li><code>input_number.hot_water_temperature</code>: This is used to set the desired hot water temperature. The code also injects the following custom attributes: <code>flow</code> which is the current flow of hot water in L/min and <code>temp</code> which is the currently set hot water temp.</li> <li><code>switch.hot_water</code>: This is an on/off switch which switches between 37C and 50C. Not strictly necessary but google assistant and siri cannot handle <code>input_number</code> so this is a workaround.</li> <li><code>switch.automation_hot_water_timeout</code>: This switch enables/ disables the automatic safety timeout. After 5 minutes of inactivity the hot water will revert to 37C. This is designed to avoid the situation where after setting a higher temperature you inadvertently scald yourself in the shower (especially important with young children with sensitive skin or where your hot water heater is capable of achieving more than 50C - strictly this should only be in a corporate environment).</li> </ul>"},{"location":"ha_old/#in-home-assistant","title":"In Home Assistant","text":"<p>Create an <code>input_number</code> helper called <code>input_number.hot_water_temperature</code>. It should have the following attributes: <pre><code>initial: 37\neditable: true\nmin: 37\nmax: 50\nstep: 1\nmode: slider\nunit_of_measurement: \u00b0C\nicon: mdi:kettle-steam-outline\nfriendly_name: Hot Water Temperature\n</code></pre></p>"},{"location":"ha_old/#in-home-assistant-lovelace-optional","title":"In Home Assistant Lovelace (Optional)","text":"<p>I am using the HACS custom card <code>multiple entity row</code> to display the flow and current temperature in lovelace neatly.  <pre><code>type: entities\nentities:\n  - entity: input_number.hot_water_temperature\n  - entity: input_number.hot_water_temperature\n    type: custom:multiple-entity-row\n    name: Status\n    show_state: false\n    icon: mdi:water-pump\n    entities:\n      - attribute: flow\n        name: Flow\n        unit: L/min\n      - attribute: temp\n        name: Current Temperature\n        unit: \u00b0C\n</code></pre></p>"},{"location":"ha_old/#node-red-flow","title":"Node-Red Flow","text":"<p>Import the following flow into Node Red - do not forget to configure the IP addresses and the HA API integrations as relevant for you.</p> <p></p> <p></p> \"Node<pre><code>[{\"id\":\"3c93a6b23de0cde5\",\"type\":\"subflow\",\"name\":\"Write Attribs\",\"info\":\"\",\"category\":\"\",\"in\":[{\"x\":80,\"y\":80,\"wires\":[{\"id\":\"6cf5b5283c883d03\"}]}],\"out\":[{\"x\":1360,\"y\":80,\"wires\":[{\"id\":\"cb3efa2e16ec5b57\",\"port\":0}]}],\"env\":[{\"name\":\"path\",\"type\":\"str\",\"value\":\"\"}],\"meta\":{},\"color\":\"#DDAA99\"},{\"id\":\"cb3efa2e16ec5b57\",\"type\":\"ha-api\",\"z\":\"3c93a6b23de0cde5\",\"name\":\"Set State\",\"server\":\"XXX\",\"version\":1,\"debugenabled\":false,\"protocol\":\"http\",\"method\":\"post\",\"path\":\"\",\"data\":\"\",\"dataType\":\"json\",\"responseType\":\"json\",\"outputProperties\":[{\"property\":\"payload\",\"propertyType\":\"msg\",\"value\":\"\",\"valueType\":\"results\"}],\"x\":1240,\"y\":80,\"wires\":[[]]},{\"id\":\"3eea47eb5abc1b38\",\"type\":\"ha-api\",\"z\":\"3c93a6b23de0cde5\",\"name\":\"Get Entity State\",\"server\":\"XXX\",\"version\":1,\"debugenabled\":false,\"protocol\":\"http\",\"method\":\"get\",\"path\":\"\",\"data\":\"\",\"dataType\":\"json\",\"responseType\":\"json\",\"outputProperties\":[{\"property\":\"payload\",\"propertyType\":\"msg\",\"value\":\"\",\"valueType\":\"results\"}],\"x\":680,\"y\":80,\"wires\":[[\"3e5395467e4b5d0e\"]]},{\"id\":\"6cf5b5283c883d03\",\"type\":\"function\",\"z\":\"3c93a6b23de0cde5\",\"name\":\"Rewrite msg to retrieve entity\",\"func\":\"msg.payload = { \\\"path\\\": \\\"/api/states/\\\" + msg.entity };\\nreturn msg;\",\"outputs\":1,\"noerr\":0,\"initialize\":\"\",\"finalize\":\"\",\"libs\":[],\"x\":260,\"y\":80,\"wires\":[[\"405c70f051b285ee\"]]},{\"id\":\"3e5395467e4b5d0e\",\"type\":\"function\",\"z\":\"3c93a6b23de0cde5\",\"name\":\"Add attributes\",\"func\":\"for(let item in msg.attributes){\\n  msg.payload.attributes[item] = msg.attributes[item]\\n}\\n\\nreturn msg;\",\"outputs\":1,\"noerr\":0,\"initialize\":\"\",\"finalize\":\"\",\"libs\":[],\"x\":860,\"y\":80,\"wires\":[[\"2dc5570020e5fd44\"]]},{\"id\":\"2dc5570020e5fd44\",\"type\":\"change\",\"z\":\"3c93a6b23de0cde5\",\"name\":\"Rewrite Data/ Path\",\"rules\":[{\"t\":\"set\",\"p\":\"payload.data\",\"pt\":\"msg\",\"to\":\"payload\",\"tot\":\"msg\",\"dc\":true},{\"t\":\"set\",\"p\":\"payload.path\",\"pt\":\"msg\",\"to\":\"path\",\"tot\":\"global\"}],\"action\":\"\",\"property\":\"\",\"from\":\"\",\"to\":\"\",\"reg\":false,\"x\":1050,\"y\":80,\"wires\":[[\"cb3efa2e16ec5b57\"]]},{\"id\":\"405c70f051b285ee\",\"type\":\"change\",\"z\":\"3c93a6b23de0cde5\",\"name\":\"Rewrite Data/ Path\",\"rules\":[{\"t\":\"set\",\"p\":\"path\",\"pt\":\"global\",\"to\":\"payload.path\",\"tot\":\"msg\"}],\"action\":\"\",\"property\":\"\",\"from\":\"\",\"to\":\"\",\"reg\":false,\"x\":490,\"y\":80,\"wires\":[[\"3eea47eb5abc1b38\"]]},{\"id\":\"0696dd904aa6c7de\",\"type\":\"tab\",\"label\":\"Rheem Hot Water\",\"disabled\":false,\"info\":\"\",\"env\":[]},{\"id\":\"35bc46e08a2a88b3\",\"type\":\"delay\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Wait 5 Minutes\",\"pauseType\":\"delay\",\"timeout\":\"300\",\"timeoutUnits\":\"seconds\",\"rate\":\"1\",\"nbRateUnits\":\"30\",\"rateUnits\":\"second\",\"randomFirst\":\"1\",\"randomLast\":\"5\",\"randomUnits\":\"seconds\",\"drop\":true,\"allowrate\":false,\"outputs\":1,\"x\":1240,\"y\":660,\"wires\":[[\"8078e213ff20ebe9\"]]},{\"id\":\"959ae573c614ed1d\",\"type\":\"change\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Reset Loops\",\"rules\":[{\"t\":\"set\",\"p\":\"reset\",\"pt\":\"msg\",\"to\":\"reset\",\"tot\":\"str\"}],\"action\":\"\",\"property\":\"\",\"from\":\"\",\"to\":\"\",\"reg\":false,\"x\":1890,\"y\":800,\"wires\":[[\"35bc46e08a2a88b3\"]]},{\"id\":\"5b42f717a84ae8e1\",\"type\":\"http request\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Get Current Info\",\"method\":\"GET\",\"ret\":\"obj\",\"paytoqs\":\"ignore\",\"url\":\"http://192.168.XXX.XXX/getInfo.cgi\",\"tls\":\"\",\"persist\":false,\"proxy\":\"\",\"authType\":\"\",\"senderr\":false,\"x\":440,\"y\":80,\"wires\":[[\"4f2aba5954beeeaf\"]]},{\"id\":\"b5f5f860f82d95f1\",\"type\":\"inject\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Status Update Worker\",\"props\":[{\"p\":\"payload\"}],\"repeat\":\"1\",\"crontab\":\"\",\"once\":true,\"onceDelay\":0.1,\"topic\":\"\",\"payload\":\"\",\"payloadType\":\"date\",\"x\":210,\"y\":80,\"wires\":[[\"5b42f717a84ae8e1\"]]},{\"id\":\"5ac0a59db72278da\",\"type\":\"ha-entity\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Hot Water Switch - Google Helper\",\"server\":\"f1028730287dd073\",\"version\":2,\"debugenabled\":false,\"outputs\":2,\"entityType\":\"switch\",\"config\":[{\"property\":\"name\",\"value\":\"Hot Water\"},{\"property\":\"device_class\",\"value\":\"\"},{\"property\":\"icon\",\"value\":\"mdi:kettle-steam-outline\"},{\"property\":\"unit_of_measurement\",\"value\":\"\"},{\"property\":\"state_class\",\"value\":\"\"},{\"property\":\"last_reset\",\"value\":\"\"}],\"state\":\"payload\",\"stateType\":\"msg\",\"attributes\":[],\"resend\":true,\"outputLocation\":\"payload\",\"outputLocationType\":\"none\",\"inputOverride\":\"allow\",\"outputOnStateChange\":true,\"outputPayload\":\"$entity().state ? \\\"on\\\": \\\"off\\\"\",\"outputPayloadType\":\"jsonata\",\"x\":220,\"y\":220,\"wires\":[[\"65619639265cf5ea\"],[\"741797cf63baafe2\"]]},{\"id\":\"65619639265cf5ea\",\"type\":\"api-call-service\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Set Water Hot\",\"server\":\"XXX\",\"version\":5,\"debugenabled\":false,\"domain\":\"input_number\",\"service\":\"set_value\",\"areaId\":[],\"deviceId\":[],\"entityId\":[\"input_number.hot_water_temperature\"],\"data\":\"{\\\"value\\\":\\\"50\\\"}\",\"dataType\":\"json\",\"mergeContext\":\"\",\"mustacheAltTags\":false,\"outputProperties\":[],\"queue\":\"none\",\"x\":500,\"y\":200,\"wires\":[[]]},{\"id\":\"741797cf63baafe2\",\"type\":\"api-call-service\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Set Water Normal\",\"server\":\"XXX\",\"version\":5,\"debugenabled\":false,\"domain\":\"input_number\",\"service\":\"set_value\",\"areaId\":[],\"deviceId\":[],\"entityId\":[\"input_number.hot_water_temperature\"],\"data\":\"{\\\"value\\\":\\\"37\\\"}\",\"dataType\":\"json\",\"mergeContext\":\"\",\"mustacheAltTags\":false,\"outputProperties\":[],\"queue\":\"none\",\"x\":510,\"y\":260,\"wires\":[[]]},{\"id\":\"2da68c06fe0159a7\",\"type\":\"subflow:3c93a6b23de0cde5\",\"z\":\"0696dd904aa6c7de\",\"name\":\"\",\"x\":790,\"y\":80,\"wires\":[[]]},{\"id\":\"4f2aba5954beeeaf\",\"type\":\"function\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Set vars\",\"func\":\"msg.attributes = {}\\nmsg.attributes[\\\"flow\\\"] = msg.payload.flow;\\nmsg.attributes[\\\"temp\\\"] = msg.payload.temp;\\nmsg.entity = \\\"input_number.hot_water_temperature\\\";\\nreturn msg;\",\"outputs\":1,\"noerr\":0,\"initialize\":\"\",\"finalize\":\"\",\"libs\":[],\"x\":620,\"y\":80,\"wires\":[[\"2da68c06fe0159a7\"]]},{\"id\":\"02ded775b14645ca\",\"type\":\"switch\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Check Temp\",\"property\":\"data.attributes.temp\",\"propertyType\":\"msg\",\"rules\":[{\"t\":\"eq\",\"v\":\"37\",\"vt\":\"num\"},{\"t\":\"else\"}],\"checkall\":\"true\",\"repair\":false,\"outputs\":2,\"x\":1310,\"y\":240,\"wires\":[[\"4e7cfaf142737137\"],[]]},{\"id\":\"2aa646efaaf4bad9\",\"type\":\"inject\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Hot Water Switch Update Worker\",\"props\":[{\"p\":\"payload\"}],\"repeat\":\"5\",\"crontab\":\"\",\"once\":true,\"onceDelay\":0.1,\"topic\":\"\",\"payload\":\"\",\"payloadType\":\"date\",\"x\":940,\"y\":240,\"wires\":[[\"cc50e38cf7f45292\"]]},{\"id\":\"cc50e38cf7f45292\",\"type\":\"api-current-state\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Get State\",\"server\":\"XXX\",\"version\":3,\"outputs\":1,\"halt_if\":\"\",\"halt_if_type\":\"str\",\"halt_if_compare\":\"is\",\"entity_id\":\"input_number.hot_water_temperature\",\"state_type\":\"str\",\"blockInputOverrides\":false,\"outputProperties\":[{\"property\":\"payload\",\"propertyType\":\"msg\",\"value\":\"\",\"valueType\":\"entityState\"},{\"property\":\"data\",\"propertyType\":\"msg\",\"value\":\"\",\"valueType\":\"entity\"}],\"for\":\"0\",\"forType\":\"num\",\"forUnits\":\"minutes\",\"override_topic\":false,\"state_location\":\"payload\",\"override_payload\":\"msg\",\"entity_location\":\"data\",\"override_data\":\"msg\",\"x\":1160,\"y\":240,\"wires\":[[\"02ded775b14645ca\"]]},{\"id\":\"4e7cfaf142737137\",\"type\":\"api-current-state\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Get Switch State\",\"server\":\"XXX\",\"version\":3,\"outputs\":2,\"halt_if\":\"on\",\"halt_if_type\":\"str\",\"halt_if_compare\":\"is\",\"entity_id\":\"switch.hot_water\",\"state_type\":\"str\",\"blockInputOverrides\":false,\"outputProperties\":[{\"property\":\"payload\",\"propertyType\":\"msg\",\"value\":\"\",\"valueType\":\"entityState\"},{\"property\":\"data\",\"propertyType\":\"msg\",\"value\":\"\",\"valueType\":\"entity\"}],\"for\":\"0\",\"forType\":\"num\",\"forUnits\":\"minutes\",\"override_topic\":false,\"state_location\":\"payload\",\"override_payload\":\"msg\",\"entity_location\":\"data\",\"override_data\":\"msg\",\"x\":1510,\"y\":240,\"wires\":[[\"8103ab9894b106a7\"],[]]},{\"id\":\"8103ab9894b106a7\",\"type\":\"api-call-service\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Turn off Switch\",\"server\":\"XXX\",\"version\":5,\"debugenabled\":false,\"domain\":\"switch\",\"service\":\"turn_off\",\"areaId\":[],\"deviceId\":[],\"entityId\":[\"switch.hot_water\"],\"data\":\"\",\"dataType\":\"jsonata\",\"mergeContext\":\"\",\"mustacheAltTags\":false,\"outputProperties\":[],\"queue\":\"none\",\"x\":1720,\"y\":240,\"wires\":[[]]},{\"id\":\"b21dcbaa561538c7\",\"type\":\"inject\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Hot Water - Requested vs Actual Temp Worker\",\"props\":[{\"p\":\"payload\"}],\"repeat\":\"1\",\"crontab\":\"\",\"once\":true,\"onceDelay\":0.1,\"topic\":\"\",\"payload\":\"\",\"payloadType\":\"date\",\"x\":300,\"y\":400,\"wires\":[[\"f3c8847a352c4ca3\"]]},{\"id\":\"f3c8847a352c4ca3\",\"type\":\"api-current-state\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Get State\",\"server\":\"XXX\",\"version\":3,\"outputs\":1,\"halt_if\":\"\",\"halt_if_type\":\"str\",\"halt_if_compare\":\"is\",\"entity_id\":\"input_number.hot_water_temperature\",\"state_type\":\"str\",\"blockInputOverrides\":false,\"outputProperties\":[{\"property\":\"payload\",\"propertyType\":\"msg\",\"value\":\"\",\"valueType\":\"entityState\"},{\"property\":\"data\",\"propertyType\":\"msg\",\"value\":\"\",\"valueType\":\"entity\"}],\"for\":\"0\",\"forType\":\"num\",\"forUnits\":\"minutes\",\"override_topic\":false,\"state_location\":\"payload\",\"override_payload\":\"msg\",\"entity_location\":\"data\",\"override_data\":\"msg\",\"x\":560,\"y\":400,\"wires\":[[\"bac57b6064eedf90\"]]},{\"id\":\"bac57b6064eedf90\",\"type\":\"switch\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Compare Requested and Actual\",\"property\":\"payload\",\"propertyType\":\"msg\",\"rules\":[{\"t\":\"eq\",\"v\":\"data.attributes.temp\",\"vt\":\"msg\"},{\"t\":\"else\"}],\"checkall\":\"true\",\"repair\":false,\"outputs\":2,\"x\":790,\"y\":400,\"wires\":[[],[\"7d997fe20b76bb1f\"]]},{\"id\":\"7d997fe20b76bb1f\",\"type\":\"switch\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Check if Min Valid\",\"property\":\"payload\",\"propertyType\":\"msg\",\"rules\":[{\"t\":\"gte\",\"v\":\"data.attributes.min\",\"vt\":\"msg\"},{\"t\":\"else\"}],\"checkall\":\"true\",\"repair\":false,\"outputs\":2,\"x\":1050,\"y\":400,\"wires\":[[\"034302e27c79d578\"],[]]},{\"id\":\"034302e27c79d578\",\"type\":\"switch\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Check if Max Valid\",\"property\":\"payload\",\"propertyType\":\"msg\",\"rules\":[{\"t\":\"lte\",\"v\":\"data.attributes.max\",\"vt\":\"msg\"},{\"t\":\"else\"}],\"checkall\":\"true\",\"repair\":false,\"outputs\":2,\"x\":1270,\"y\":400,\"wires\":[[\"ab64e497209d9b70\"],[]]},{\"id\":\"ab64e497209d9b70\",\"type\":\"change\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Store it in flow.temperature\",\"rules\":[{\"t\":\"set\",\"p\":\"temperature\",\"pt\":\"flow\",\"to\":\"payload\",\"tot\":\"msg\"}],\"action\":\"\",\"property\":\"\",\"from\":\"\",\"to\":\"\",\"reg\":false,\"x\":1520,\"y\":400,\"wires\":[[\"eced634799386a54\"]]},{\"id\":\"eced634799386a54\",\"type\":\"http request\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Take Control of Rheem System\",\"method\":\"GET\",\"ret\":\"obj\",\"paytoqs\":\"ignore\",\"url\":\"http://192.168.XXX.XXX/ctrl.cgi?sid=0&amp;heatingCtrl=1\",\"tls\":\"\",\"persist\":false,\"proxy\":\"\",\"authType\":\"\",\"senderr\":false,\"x\":250,\"y\":480,\"wires\":[[\"9746d74387ecf508\"]]},{\"id\":\"9746d74387ecf508\",\"type\":\"switch\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Check if Error\",\"property\":\"payload.sid\",\"propertyType\":\"msg\",\"rules\":[{\"t\":\"eq\",\"v\":\"0\",\"vt\":\"str\"},{\"t\":\"else\"}],\"checkall\":\"true\",\"repair\":false,\"outputs\":2,\"x\":500,\"y\":480,\"wires\":[[],[\"b14b73714804ea04\"]]},{\"id\":\"b14b73714804ea04\",\"type\":\"change\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Store Session ID in flow.sid\",\"rules\":[{\"t\":\"set\",\"p\":\"sid\",\"pt\":\"flow\",\"to\":\"payload.sid\",\"tot\":\"msg\"}],\"action\":\"\",\"property\":\"\",\"from\":\"\",\"to\":\"\",\"reg\":false,\"x\":740,\"y\":480,\"wires\":[[\"0693e8ca6891c5db\"]]},{\"id\":\"0693e8ca6891c5db\",\"type\":\"function\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Setup the url\",\"func\":\"var t = flow.get(\\\"temperature\\\");\\nvar s = flow.get(\\\"sid\\\");\\n\\nmsg.url = \\\"http://192.168.XXX.XXX/set.cgi?sid=\\\" + s + \\\"&amp;setTemp=\\\" + t\\n\\nreturn msg;\",\"outputs\":1,\"noerr\":0,\"initialize\":\"\",\"finalize\":\"\",\"libs\":[],\"x\":950,\"y\":480,\"wires\":[[\"537a2e81dc41d614\"]]},{\"id\":\"537a2e81dc41d614\",\"type\":\"http request\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Request New Temp\",\"method\":\"GET\",\"ret\":\"obj\",\"paytoqs\":\"ignore\",\"url\":\"\",\"tls\":\"\",\"persist\":false,\"proxy\":\"\",\"authType\":\"\",\"senderr\":false,\"x\":1130,\"y\":480,\"wires\":[[\"74d1ee1c63cfa749\"]]},{\"id\":\"74d1ee1c63cfa749\",\"type\":\"switch\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Check for Error State\",\"property\":\"payload.reqtemp\",\"propertyType\":\"msg\",\"rules\":[{\"t\":\"eq\",\"v\":\"temperature\",\"vt\":\"flow\"},{\"t\":\"else\"}],\"checkall\":\"true\",\"repair\":false,\"outputs\":2,\"x\":1340,\"y\":480,\"wires\":[[\"51a197d8852cecb5\"],[\"d4d276c7a7a33b42\",\"62334558a9bb2eb5\",\"51a197d8852cecb5\"]]},{\"id\":\"62334558a9bb2eb5\",\"type\":\"debug\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Send Debug Message\",\"active\":true,\"tosidebar\":true,\"console\":true,\"tostatus\":false,\"complete\":\"payload\",\"targetType\":\"msg\",\"statusVal\":\"\",\"statusType\":\"auto\",\"x\":1610,\"y\":540,\"wires\":[]},{\"id\":\"d4d276c7a7a33b42\",\"type\":\"debug\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Send Debug Message\",\"active\":true,\"tosidebar\":true,\"console\":true,\"tostatus\":false,\"complete\":\"url\",\"targetType\":\"msg\",\"statusVal\":\"\",\"statusType\":\"auto\",\"x\":1610,\"y\":580,\"wires\":[]},{\"id\":\"51a197d8852cecb5\",\"type\":\"delay\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Wait 1s\",\"pauseType\":\"delay\",\"timeout\":\"1\",\"timeoutUnits\":\"seconds\",\"rate\":\"1\",\"nbRateUnits\":\"1\",\"rateUnits\":\"second\",\"randomFirst\":\"1\",\"randomLast\":\"5\",\"randomUnits\":\"seconds\",\"drop\":false,\"allowrate\":false,\"outputs\":1,\"x\":1560,\"y\":480,\"wires\":[[\"ad81a1605da79aad\"]]},{\"id\":\"ad81a1605da79aad\",\"type\":\"function\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Setup the url\",\"func\":\"var s = flow.get(\\\"sid\\\");\\n\\nmsg.url = \\\"http://192.168.XXX.XXX/ctrl.cgi?sid=\\\" + s + \\\"&amp;heatingCtrl=0\\\"\\n\\nreturn msg;\",\"outputs\":1,\"noerr\":0,\"initialize\":\"\",\"finalize\":\"\",\"libs\":[],\"x\":1730,\"y\":480,\"wires\":[[\"a76078cb19481e28\"]]},{\"id\":\"a76078cb19481e28\",\"type\":\"http request\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Relinquish Control\",\"method\":\"GET\",\"ret\":\"obj\",\"paytoqs\":\"ignore\",\"url\":\"\",\"tls\":\"\",\"persist\":false,\"proxy\":\"\",\"authType\":\"\",\"senderr\":false,\"x\":1910,\"y\":480,\"wires\":[[\"9c423f42122a3e93\"]]},{\"id\":\"9c423f42122a3e93\",\"type\":\"switch\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Check for Error State\",\"property\":\"payload.sTimeout\",\"propertyType\":\"msg\",\"rules\":[{\"t\":\"eq\",\"v\":\"0\",\"vt\":\"str\"},{\"t\":\"else\"}],\"checkall\":\"true\",\"repair\":false,\"outputs\":2,\"x\":2120,\"y\":480,\"wires\":[[],[\"5d703d0aac38620e\",\"5d333b0168fd49af\"]]},{\"id\":\"5d703d0aac38620e\",\"type\":\"debug\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Send Debug Message\",\"active\":true,\"tosidebar\":true,\"console\":true,\"tostatus\":false,\"complete\":\"payload\",\"targetType\":\"msg\",\"statusVal\":\"\",\"statusType\":\"auto\",\"x\":2390,\"y\":500,\"wires\":[]},{\"id\":\"5d333b0168fd49af\",\"type\":\"debug\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Send Debug Message\",\"active\":true,\"tosidebar\":true,\"console\":true,\"tostatus\":false,\"complete\":\"url\",\"targetType\":\"msg\",\"statusVal\":\"\",\"statusType\":\"auto\",\"x\":2390,\"y\":540,\"wires\":[]},{\"id\":\"020edd2b2bd16f44\",\"type\":\"server-state-changed\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Automation - Hot Water Timeout\",\"server\":\"f1028730287dd073\",\"version\":4,\"exposeToHomeAssistant\":true,\"haConfig\":[{\"property\":\"name\",\"value\":\"Automation - Hot Water Timeout\"},{\"property\":\"icon\",\"value\":\"mdi:kettle-steam-outline\"}],\"entityidfilter\":\"input_number.hot_water_temperature\",\"entityidfiltertype\":\"exact\",\"outputinitially\":false,\"state_type\":\"str\",\"haltifstate\":\"\",\"halt_if_type\":\"str\",\"halt_if_compare\":\"is\",\"outputs\":1,\"output_only_on_state_change\":true,\"for\":\"0\",\"forType\":\"num\",\"forUnits\":\"minutes\",\"ignorePrevStateNull\":false,\"ignorePrevStateUnknown\":false,\"ignorePrevStateUnavailable\":false,\"ignoreCurrentStateUnknown\":false,\"ignoreCurrentStateUnavailable\":false,\"outputProperties\":[{\"property\":\"payload\",\"propertyType\":\"msg\",\"value\":\"\",\"valueType\":\"entityState\"},{\"property\":\"data\",\"propertyType\":\"msg\",\"value\":\"\",\"valueType\":\"eventData\"},{\"property\":\"topic\",\"propertyType\":\"msg\",\"value\":\"\",\"valueType\":\"triggerId\"}],\"x\":230,\"y\":620,\"wires\":[[\"d179e77ab80c9fe8\",\"959ae573c614ed1d\"]]},{\"id\":\"d179e77ab80c9fe8\",\"type\":\"api-current-state\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Get State\",\"server\":\"XXX\",\"version\":3,\"outputs\":1,\"halt_if\":\"\",\"halt_if_type\":\"str\",\"halt_if_compare\":\"is\",\"entity_id\":\"input_number.hot_water_temperature\",\"state_type\":\"str\",\"blockInputOverrides\":false,\"outputProperties\":[{\"property\":\"payload\",\"propertyType\":\"msg\",\"value\":\"\",\"valueType\":\"entityState\"},{\"property\":\"data\",\"propertyType\":\"msg\",\"value\":\"\",\"valueType\":\"entity\"}],\"for\":\"0\",\"forType\":\"num\",\"forUnits\":\"minutes\",\"override_topic\":false,\"state_location\":\"payload\",\"override_payload\":\"msg\",\"entity_location\":\"data\",\"override_data\":\"msg\",\"x\":460,\"y\":620,\"wires\":[[\"681e05a0cfa36406\"]]},{\"id\":\"95b372d14c567897\",\"type\":\"switch\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Compare Requested and Actual\",\"property\":\"payload\",\"propertyType\":\"msg\",\"rules\":[{\"t\":\"eq\",\"v\":\"data.attributes.temp\",\"vt\":\"msg\"},{\"t\":\"else\"}],\"checkall\":\"true\",\"repair\":false,\"outputs\":2,\"x\":890,\"y\":620,\"wires\":[[\"35bc46e08a2a88b3\"],[\"b838db2d3d9b6ded\"]]},{\"id\":\"681e05a0cfa36406\",\"type\":\"switch\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Check != 37C\",\"property\":\"payload\",\"propertyType\":\"msg\",\"rules\":[{\"t\":\"eq\",\"v\":\"37\",\"vt\":\"str\"},{\"t\":\"else\"}],\"checkall\":\"true\",\"repair\":false,\"outputs\":2,\"x\":640,\"y\":620,\"wires\":[[],[\"95b372d14c567897\"]]},{\"id\":\"b838db2d3d9b6ded\",\"type\":\"delay\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Wait 5 Seconds and Recheck\",\"pauseType\":\"delay\",\"timeout\":\"5\",\"timeoutUnits\":\"seconds\",\"rate\":\"1\",\"nbRateUnits\":\"1\",\"rateUnits\":\"second\",\"randomFirst\":\"1\",\"randomLast\":\"5\",\"randomUnits\":\"seconds\",\"drop\":false,\"allowrate\":false,\"outputs\":1,\"x\":700,\"y\":740,\"wires\":[[\"d179e77ab80c9fe8\"]]},{\"id\":\"8078e213ff20ebe9\",\"type\":\"api-call-service\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Reset to 37C\",\"server\":\"XXX\",\"version\":5,\"debugenabled\":false,\"domain\":\"input_number\",\"service\":\"set_value\",\"areaId\":[],\"deviceId\":[],\"entityId\":[\"input_number.hot_water_temperature\"],\"data\":\"{ \\\"value\\\": \\\"37\\\" }\",\"dataType\":\"json\",\"mergeContext\":\"\",\"mustacheAltTags\":false,\"outputProperties\":[],\"queue\":\"none\",\"x\":1690,\"y\":660,\"wires\":[[\"959ae573c614ed1d\"]]},{\"id\":\"3ec6ac59388682b9\",\"type\":\"inject\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Poll Flow Worker\",\"props\":[{\"p\":\"payload\"}],\"repeat\":\"1\",\"crontab\":\"\",\"once\":true,\"onceDelay\":0.1,\"topic\":\"\",\"payload\":\"\",\"payloadType\":\"date\",\"x\":370,\"y\":840,\"wires\":[[\"d4554cd9f38e3f30\"]]},{\"id\":\"d4554cd9f38e3f30\",\"type\":\"api-current-state\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Get State\",\"server\":\"XXX\",\"version\":3,\"outputs\":1,\"halt_if\":\"\",\"halt_if_type\":\"str\",\"halt_if_compare\":\"is\",\"entity_id\":\"input_number.hot_water_temperature\",\"state_type\":\"str\",\"blockInputOverrides\":false,\"outputProperties\":[{\"property\":\"payload\",\"propertyType\":\"msg\",\"value\":\"\",\"valueType\":\"entityState\"},{\"property\":\"data\",\"propertyType\":\"msg\",\"value\":\"\",\"valueType\":\"entity\"}],\"for\":\"0\",\"forType\":\"num\",\"forUnits\":\"minutes\",\"override_topic\":false,\"state_location\":\"payload\",\"override_payload\":\"msg\",\"entity_location\":\"data\",\"override_data\":\"msg\",\"x\":560,\"y\":840,\"wires\":[[\"5332bd453508c644\"]]},{\"id\":\"0ea7afe3f483a560\",\"type\":\"switch\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Check Flow\",\"property\":\"data.attributes.flow\",\"propertyType\":\"msg\",\"rules\":[{\"t\":\"eq\",\"v\":\"0\",\"vt\":\"str\"},{\"t\":\"else\"}],\"checkall\":\"true\",\"repair\":false,\"outputs\":2,\"x\":950,\"y\":840,\"wires\":[[],[\"1a11dee923b44306\"]]},{\"id\":\"1a11dee923b44306\",\"type\":\"change\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Reset Loop\",\"rules\":[{\"t\":\"set\",\"p\":\"reset\",\"pt\":\"msg\",\"to\":\"reset\",\"tot\":\"str\"}],\"action\":\"\",\"property\":\"\",\"from\":\"\",\"to\":\"\",\"reg\":false,\"x\":1130,\"y\":840,\"wires\":[[\"35bc46e08a2a88b3\",\"04a9bf9e4cfa56d0\"]]},{\"id\":\"7e084e804021f322\",\"type\":\"delay\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Wait 0.1s\",\"pauseType\":\"delay\",\"timeout\":\"100\",\"timeoutUnits\":\"milliseconds\",\"rate\":\"1\",\"nbRateUnits\":\"1\",\"rateUnits\":\"second\",\"randomFirst\":\"1\",\"randomLast\":\"5\",\"randomUnits\":\"seconds\",\"drop\":false,\"allowrate\":false,\"outputs\":1,\"x\":1520,\"y\":840,\"wires\":[[\"35bc46e08a2a88b3\"]]},{\"id\":\"5332bd453508c644\",\"type\":\"switch\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Check Temp\",\"property\":\"payload\",\"propertyType\":\"msg\",\"rules\":[{\"t\":\"eq\",\"v\":\"37\",\"vt\":\"num\"},{\"t\":\"else\"}],\"checkall\":\"true\",\"repair\":false,\"outputs\":2,\"x\":770,\"y\":840,\"wires\":[[\"e164b7b994e53747\"],[\"0ea7afe3f483a560\"]]},{\"id\":\"04a9bf9e4cfa56d0\",\"type\":\"change\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Clear Reset\",\"rules\":[{\"t\":\"delete\",\"p\":\"reset\",\"pt\":\"msg\"}],\"action\":\"\",\"property\":\"\",\"from\":\"\",\"to\":\"\",\"reg\":false,\"x\":1350,\"y\":840,\"wires\":[[\"7e084e804021f322\"]]},{\"id\":\"e164b7b994e53747\",\"type\":\"change\",\"z\":\"0696dd904aa6c7de\",\"name\":\"Reset Loop\",\"rules\":[{\"t\":\"set\",\"p\":\"reset\",\"pt\":\"msg\",\"to\":\"reset\",\"tot\":\"str\"}],\"action\":\"\",\"property\":\"\",\"from\":\"\",\"to\":\"\",\"reg\":false,\"x\":950,\"y\":760,\"wires\":[[\"35bc46e08a2a88b3\"]]}]\n</code></pre>"},{"location":"hacc/","title":"Home Assistant","text":"<p>This is my home assistant custom component..</p> <p>Note: I strongly recommend you read the warnings and copy the safety features that are built into the node-red flow.</p>"},{"location":"hardware/","title":"Hardware","text":"<p>Note: The information on this page is incomplete. The author has not disassembled his unit to further investigate what his limited investigations have revealed.</p>"},{"location":"hardware/#use-case","title":"Use Case","text":"<p>According to information on Rheem's own website, this unit can be used on:</p> <ul> <li>Rheem 12L (876812)</li> <li>Rheem Metro 16L (876T16)</li> <li>Rheem 20L (876820)</li> <li>Rheem Metro 26L (876T26)</li> <li>Rheem 27L (876627, 876027, 866627, 866027)</li> </ul> <p>Rheem claims that the device is only suitable for Rheem 12L to 26L models manufactured since 2018.</p> <p>Although the author hasn't investigated the matter further, it is unclear why this unit is restricted to models built after 2018. The device emulates the functionality of common kitchen side and bathroom side controllers that have been available for many years. The author does note that the unit may not fit with the included mount inside older models. Certainly, the authors prior unit that was manufactured in 2009 did not have sufficient clearance to fit this device with the standard mount - that said, with some ingenuity the author is certain that this could be made to work (even if not specifically surpported by the vendor).</p>"},{"location":"hardware/#kit","title":"Kit","text":"<p>Pictured above is the contents which you should receive.</p> <p>Clockwise from the top-left they are: - Box (items unpacked from box) - Control Module (this is installed inside your water heater) - MAC Address sticker (this is applied to your water heater and is required to comply with ACMA) - (Bottom) 2x installation brackets (read the installation instructions, you may need to use 0, 1 or 2 of these depending on your unit). - (Middle) Powerline Unit - (Bottom) Ethernet cable to connect to your switch/ router/ modem - (Middle) Installation Instructions - 3x Mounting Screws</p>"},{"location":"hardware/#powerline-unit","title":"Powerline Unit","text":"<p>Based upon investigations, this unit appears to be purely passive. It communicates with the Control Module and passes that information through using ethernet (10/100T).</p> <p>This information has been surmised because turning off power to the control module results in no response at all from the http server provided by this device.</p> <p>Rheem Australia uses a specific MAC Address block it has acquired for the purposes of this unit - the following information is extracted from the IEEE MAC Assignments database:</p> <pre><code>50-98-F3   (hex)        Rheem Australia Pty Ltd\n5098F3     (base 16)        Rheem Australia Pty Ltd\n                1 Alan Street\n                Rydalmere  NSW  2116\n                AU\n</code></pre>"},{"location":"hardware/#update-281-credits-to-jdymond","title":"Update 28/1: Credits to jdymond","text":"<p>The powerline unit communicates over the electrical network in the house with the heater which should allow you to put it anywhere as long as it is on the same circuit. This is similar to the Ethernet-over-Power type networking gear available from TP-Link, DLink, etc. There may be connectivity issues in some scenarios though:</p> <ul> <li> <p>on a house with 3-phase power, putting the heater and powerline unit on different phases wont work (physically separated power lines).</p> </li> <li> <p>the heater and powerline unit on the same phase but different circuits in the house. The signal degrades heavily when passing over circuit breakers and/ or protection devices (e.g. UPS or solar battery)</p> </li> <li> <p>you are already using an Ethernet over Power type networking device which is interfering with this signal.</p> </li> </ul> <p>The ideal setup is having the heater and powerline adapter on the same circuit if possible with no power filters in between.</p>"},{"location":"hardware/#control-module","title":"Control Module","text":"<p>This device is installed inside the water heater unit. </p> <p>The white set of 2 cables piggy backs on low voltage the power supply to the water heater control circuitry.</p> <p>The black set of cables plugs into the water temperature input/output that is used by Rheem's normal temperature setting devices.</p> <p>This control module also operates the webserver which is used to control the temperature of the water heater.</p>"},{"location":"logic/","title":"Logic","text":"<p>This page attempts to explain the logical flow of how to control the water heater.</p> <ol> <li>By default, the user does not have a control privileges via a session. During an unprivileged session, the user may access: <code>heaterName.cgi</code>, <code>version.cgi</code>, <code>getParams.cgi</code> and <code>getInfo.cgi</code></li> <li>A user may escalate their session to control privileges via <code>ctrl.cgi</code> by requesting Heating Control or Bath Fill Control. While having control privileges, this exposes further information under <code>getInfo.cgi</code> and <code>set.cgi</code>.</li> <li>The system will wait for the session timer and then timeout the control privileges. Using a <code>set.cgi</code> command will reset your session timer as will turning on the hot water.</li> <li>Your control privileges expire after the session timer runs out.</li> </ol>"},{"location":"network/","title":"Network","text":""},{"location":"network/#control-module","title":"Control Module","text":"<p>As far as the author can tell, the control module is the device on which the http web server runs.</p> <p>Based upon deductive reasoning that:</p> <ol> <li>If the water heater is turned off, the http web server becomes completely unresponsive.</li> <li>There appears to be a weak/ intermittent connection between the control module and the powerline unit (possibly zigbee, bluetooth or some other short range communication standard given the control module has intermittent connection from approximately 3 metres away).</li> </ol>"},{"location":"network/#powerline-unit","title":"Powerline Unit","text":"<p>As far as the author can tell, the Powerline Unit simply relays what the Control Module sends it onto LAN.</p> <p>It appears to me that the reason this has been done is because Rheem does not want to deal with the technical hassle of WiFi (and having to change wifi settings if the home network changes). I would also note that having WiFi on a device like this is fraught with danger (see my vulnerability analysis of LG Inverters<sup>1</sup>).</p>"},{"location":"network/#http","title":"http","text":"<p>I used packet sniffing software on the android app to determine how connectivity worked. It is unclear to me how the device determines that there is </p> <p>A nmap scan reveals only port 80 is open on this device.</p> <p>The device only communicates via LAN and does not have any innate cloud connectivity whatsoever (even though the server self reprots as embedded.rheem.com.au).</p> <p>Using curl in verbose mode to reveal the http headers reveals the following:</p> <p><pre><code>*   Trying 192.168.XXX.XXX:80...\n* Connected to 192.168.XXX.XXX (192.168.XXX.XXX) port 80 (#0)\n&gt; GET /getInfo.cgi HTTP/1.1\n&gt; Host: 192.168.XXX.XXX\n&gt; User-Agent: curl/7.79.1\n&gt; Accept: */*\n&gt;\n* Mark bundle as not supporting multiuse\n* HTTP 1.0, assume close after body\n&lt; HTTP/1.0 200 OK\nHTTP/1.0 200 OK\n&lt; Server: embedded.rheem.com.au\nServer: embedded.rheem.com.au\n&lt; Content-type: application/json\nContent-type: application/json\n</code></pre> The device does not respond to requests on any other port.</p> <ol> <li> <p>https://github.com/illuzn/LGResuAdvisory\u00a0\u21a9</p> </li> </ol>"},{"location":"protocol/","title":"Protocol","text":"<p>All requests are made using HTTP GET and are case sensitive. Each subheading below should be passed to your device as follows: <pre><code>curl http://192.168.XXX.XXX/heaterName.cgi`\n</code></pre></p> <p>All inputs are also passed via standard HTTP GET arguments as follows: <pre><code>curl http://192.168.XXX.XXX/ctrl.cgi?sid=0&amp;heatingCtrl=1\n</code></pre></p> <p>All responses are provided in JSON.</p>"},{"location":"protocol/#ddos-protection","title":"DDoS protection","text":"<p>Note: This information is based on speculation, the author has not seen the underlying code to confirm whether or not it is correct.</p> <p>My Rheem water heater has some basic DDoS protection which was causing lots of connectivity issues which I had thought was due to the devices being around 10 metres apart and seperated by a wall and (including a metal door) - which I thought was reducing signal strength.</p> <p>Essentially, if the device receives more than 1 request per second (the author cannot determine the precise limits of this), the device will enter a state whereby it will refuse all connections. Since updating to the new Home Assistant logic provided here I haven't run into this issue for around 3 weeks (it previously occurred almost daily especially when there would tend to be a lot of radio interference).</p> <p>Continued requests (again the author cannot state what this limit is) will cause the device to lock itself down and refuse to answer any requests until the water heater is physically switched on and off again.</p>"},{"location":"protocol/#heaternamecgi","title":"/heaterName.cgi","text":"<p>Example output: <pre><code>{\"heaterName\":\"Rheem\"}\n</code></pre></p> <p>Inputs: <pre><code>None\n</code></pre></p> <p>Outputs:</p> Name Type Description heaterName string The friendly name of your heater unit."},{"location":"protocol/#versioncgi","title":"/version.cgi","text":"<p>Example output: <pre><code>{\"FWversion\":\"1.4\"}\n</code></pre></p> <p>Inputs: <pre><code>None\n</code></pre></p> <p>Outputs:</p> Name Type Description FWversion string The firmware version of your control unit."},{"location":"protocol/#getparamscgi","title":"/getParams.cgi","text":"<p>Example output: <pre><code>{\"heaterModel\":1,\"tempMax\":50,\"tempMin\":37,\"bathtempMax\":48,\"bathtempMin\":37,\"bathvolMax\":500,\"bathvolMin\":10}\n</code></pre></p> <p>Inputs: <pre><code>None\n</code></pre></p> <p>Outputs:</p> Name Type Description heaterModel integer Unknown for now. My unit responds with 1. Further research is required to enumerate the model numbers. tempMax integer The maximum temperature that the hot water supply can provide. tempMin integer The minimum temperature that the hot water supply can provide. bathtempMax integer The maximum temperature that the hot water can supply for Bath Fill mode. This mode is designed (as the name implies) to supply a large fixed volume of water at once for filling baths. After the volume is supplied, the water supply will turn itself off. bathtempMin integer The minimum temmperature for Bath Fill mode (see above). bathvolMax integer The maximum volume of water to supply for Bath Fill mode (see above). bathvolMin integer The minimum volume of water to supply for Bath Fill mode (see above)."},{"location":"protocol/#getinfocgi","title":"/getInfo.cgi","text":"<p>Example output: <pre><code>{\"heaterName\":\"Rheem\",\"mode\":10,\"temp\":37,\"flow\":0.0,\"wtemp\":14.1,\"intemp\":17.9,\"state\":1,\"appErrCode\":0,\"sid\":1154,\"sessionTimer\":300,\"sTimeout\":248,\"heatingCtrl\":1,\"bathfillCtrl\":0}\n</code></pre></p> <p>Inputs:</p> Name Required Type Description sid false integer A session id from <code>/ctrl.cgi</code>. If session id is provided then the extra outputs below are revealed. <p>Outputs:</p> Name sid Required Type Description heaterName false string The friendly name of your heater unit. mode false integer See below table. temp false integer The requested hot water temperature flow false float The current flow of hot water through the unit in L/ min rounded to 1 decimal place. state false integer 1 = idle, 2 = water heater active, 3 = valve closed after bath fill appErrCode false integer Apparently, an error code output - codes unknown for now. sTimeout false integer If a user has control of the water heater, returns the time left until that session expires in seconds. Otherwise, returns 0. sessionTimer false integer Returns the configured session timeout for a user in seconds. bathtemp false integer If bath fill mode is activated, returns the requested bath fill temperature. bathvol false integer If bath fill mode is activated, returns the requested bath fill volume. fillPercent false float If bath fill mode is activated, returns approximate percentage of bath volume dispensed (this percentage is not accurate for very small bath fill volumes). wtemp true float The current water temperature as read from the heating block of the water heater in degrees celcius rounded to 1 decimal place. intemp true float The current intake water temperature from supply in degrees celcius rounded to 1 decimal place. sid true integer Returns your current session id. heatingCtrl true integer Returns 1 if you currently have control of the water heater using conventional mode. Otherwise returns 0. bathfillCtrl true integer Returns 1 if you currently have control of th water heater using bath fill mode. Otherwise returns 0. <p>Modes:</p> Value Description 5 Idle 10 Heating Control Mode 15 Water Heater Active (Conventional Mode) 20 Bath Fill Active (Waiting for Tap Open) 25 Water Heater Active (Bath Fill Mode) 35 Bath Fill Complete (Water Flow Disabled)"},{"location":"protocol/#ctrlcgi-conventional","title":"/ctrl.cgi Conventional","text":"<p>Example output: <pre><code>{\"sid\":463,\"sTimeout\":300,\"heatingCtrl\":1,\"bathfillCtrl\":0}\n</code></pre></p> <p>Inputs:</p> Name Required Type Description sid false integer A session id from <code>/ctrl.cgi</code>. A session id of 0 must be provided to take control of the water heater. heatingCtrl false integer 1 = Take control, 0 = Relinquish control <p>Outputs:</p> Name sid Required Type Description sid false integer Returns your sid, if you have control. Otherwise, returns 0. sTimeout false integer If a user has control of the water heater, returns the time left until that session expires in seconds. Otherwise, returns 0. heatingCtrl true 1 = Your session has control, 0 = Your session does not have control. bathfillCtrl true integer See Bath Fill Mode below."},{"location":"protocol/#ctrlcgi-bath-fill-mode","title":"/ctrl.cgi Bath Fill Mode","text":"<p>Example output: <pre><code>{\"sid\":649,\"sTimeout\":60,\"heatingCtrl\":0,\"bathfillCtrl\":1,\"reqbathtemp\":37,\"reqbathvol\":10}\n</code></pre></p> <p>Inputs:</p> Name Required Type Description sid true integer A session id from <code>/ctrl.cgi</code>. A session id of 0 must be provided to take control of the water heater. bathfillCtrl true integer 1 = Take control, 0 = Relinquish control setBathTemp false integer (Required if batthfillCtrl=1) A requested temperature for the bath fill in degrees celcius. setBathVol false integer (Required if batthfillCtrl=1) A requested volume for the bath fill in litres of water. <p>Outputs:</p> Name sid Required Type Description sid false integer Returns your sid, if you have control. Otherwise, returns 0. sTimeout false integer If a user has control of the water heater, returns the time left until that session expires in seconds. Otherwise, returns 0. heatingCtrl true 1 = Your session has control, 0 = Your session does not have control. bathfillCtrl true integer 1 = Your session has control, 0 = Your session does not have control. reqbathtemp true integer Returns your requested bath fill temperature in degrees celcius. reqbathvol true integer Returns your requested bath fill volume in litres."},{"location":"protocol/#setcgi","title":"/set.cgi","text":"<p>These commands require that you have control via <code>/ctrl.cgi</code> and a session id. At least one of the command inputs must be provided.</p> <p>Inputs:</p> Name Required Type Description sid true integer A session id from <code>/ctrl.cgi</code>. setTemp false integer Sets the requested hot water temperature in degrees celcius. You can reduce the temperature while water is flowing and you can also increase the temperature to a maximum of 43C (if you take control before turning on the water). setSessionTimer false integer Sets the session timer in seconds after which your control of the water heater will automatically timeout and allow other users control. <p>Outputs - setTemp:</p> Name Type Description temp integer Returns the previously set temperature reqtemp integer Returns your requested temperature sid integer Returns your session id sTimeout integer Returns your timeout. <p>Outputs - setSessionTimer</p> Name Type Description SessionTimer integer Returns your requested session timer"}]}